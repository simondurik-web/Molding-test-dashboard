<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Roll Tech Operations Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        :root {
            --primary: #1a365d;
            --primary-light: #2c5282;
            --accent: #3182ce;
            --success: #38a169;
            --success-light: #68d391;
            --danger: #e53e3e;
            --danger-light: #fc8181;
            --warning: #d69e2e;
            --purple: #805ad5;
            --teal: #319795;
            --orange: #dd6b20;
            --staged-blue: #4299e1;
            --bg-dark: #1a202c;
            --bg-card: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #a0aec0;
            --border: #4a5568;
            --sidebar-width: 260px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #0d1421 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            font-size: 14px;
        }
        .sidebar {
            position: fixed; left: 0; top: 0; width: var(--sidebar-width); height: 100vh;
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%);
            padding: 20px 12px; overflow-y: auto; z-index: 1000;
            box-shadow: 4px 0 20px rgba(0,0,0,0.4); transition: transform 0.3s ease;
        }
        .logo { text-align: center; padding: 18px 0; border-bottom: 1px solid rgba(255,255,255,0.15); margin-bottom: 20px; }
        .logo h1 { font-size: 26px; font-weight: 700; background: linear-gradient(135deg, #fff 0%, #a0aec0 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .logo span { font-size: 11px; color: var(--text-secondary); display: block; margin-top: 4px; }
        .nav-section { margin-bottom: 16px; }
        .nav-section-title { font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-secondary); margin-bottom: 8px; padding-left: 14px; font-weight: 700; }
        .nav-item { display: flex; align-items: center; padding: 11px 14px; margin: 3px 0; border-radius: 10px; cursor: pointer; transition: all 0.2s ease; color: rgba(255,255,255,0.85); font-size: 12px; font-weight: 500; }
        .nav-item:hover { background: rgba(255,255,255,0.1); transform: translateX(4px); }
        .nav-item.active { background: linear-gradient(135deg, var(--accent) 0%, #4299e1 100%); color: white; box-shadow: 0 4px 15px rgba(49,130,206,0.5); }
        .nav-item .icon { margin-right: 10px; font-size: 16px; }
        .nav-item.sub-item { padding-left: 36px; font-size: 11px; opacity: 0.9; }
        .nav-divider { height: 1px; background: rgba(255,255,255,0.1); margin: 12px 8px; }
        .data-info { font-size: 10px; color: var(--text-secondary); padding: 14px 10px; border-top: 1px solid rgba(255,255,255,0.1); margin-top: auto; }
        .data-info strong { color: var(--text-primary); display: block; margin-bottom: 4px; font-size: 11px; }
        .lang-toggle { display: flex; gap: 4px; background: var(--bg-dark); border-radius: 8px; padding: 3px; margin: 10px 8px; }
        .lang-btn { flex: 1; padding: 6px 10px; border: none; background: transparent; color: var(--text-secondary); font-size: 11px; font-weight: 600; cursor: pointer; border-radius: 6px; transition: all 0.2s; }
        .lang-btn.active { background: var(--accent); color: white; }
        .main-content { margin-left: var(--sidebar-width); padding: 20px 24px; min-height: 100vh; }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .page-header { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 12px; }
        .page-header h2 { font-size: 28px; font-weight: 700; background: linear-gradient(135deg, #fff 0%, #e2e8f0 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .page-header p { color: var(--text-secondary); font-size: 13px; margin-top: 4px; }
        .last-updated { font-size: 11px; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; }
        .last-updated .dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .dept-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .dept-card { background: linear-gradient(135deg, var(--bg-card) 0%, #374151 100%); border-radius: 16px; padding: 24px; border: 1px solid var(--border); cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }
        .dept-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; }
        .dept-card.sales::before { background: linear-gradient(90deg, var(--success), var(--teal)); }
        .dept-card.production::before { background: linear-gradient(90deg, var(--accent), var(--purple)); }
        .dept-card.inventory::before { background: linear-gradient(90deg, var(--teal), var(--accent)); }
        .dept-card:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0,0,0,0.4); border-color: var(--accent); }
        .dept-card .icon-large { font-size: 40px; margin-bottom: 12px; }
        .dept-card h3 { font-size: 20px; margin-bottom: 8px; }
        .dept-card p { color: var(--text-secondary); font-size: 12px; margin-bottom: 16px; }
        .dept-card .metrics { display: flex; gap: 20px; flex-wrap: wrap; }
        .dept-card .metric .value { font-size: 22px; font-weight: 700; }
        .dept-card .metric .label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; }
        .quick-stats { display: grid; grid-template-columns: repeat(6, 1fr); gap: 14px; margin-bottom: 24px; }
        .quick-stat { background: linear-gradient(135deg, var(--bg-card) 0%, #374151 100%); border-radius: 12px; padding: 16px; border: 1px solid var(--border); text-align: center; }
        .quick-stat .value { font-size: 24px; font-weight: 700; }
        .quick-stat .value.positive { color: var(--success); }
        .quick-stat .value.negative { color: var(--danger); }
        .quick-stat .value.warning { color: var(--warning); }
        .quick-stat .label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; margin-top: 4px; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, var(--bg-card) 0%, #374151 100%); border-radius: 14px; padding: 18px 20px; border: 1px solid var(--border); transition: transform 0.2s, box-shadow 0.2s; position: relative; overflow: hidden; }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--accent), var(--teal)); }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .stat-card .label { font-size: 10px; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 8px; letter-spacing: 0.8px; font-weight: 600; }
        .stat-card .value { font-size: 24px; font-weight: 700; }
        .stat-card .value.positive { color: var(--success); }
        .stat-card .value.negative { color: var(--danger); }
        .stat-card .sub { font-size: 11px; color: var(--text-secondary); margin-top: 6px; }
        .info-banner { border-radius: 12px; padding: 14px 18px; margin-bottom: 20px; display: none; }
        .info-banner.active { display: flex; align-items: center; gap: 12px; }
        .info-banner.warning { background: linear-gradient(135deg, #744210 0%, #975a16 100%); border: 1px solid var(--warning); }
        .info-banner.warning p { color: #fefcbf; }
        .info-banner.danger { background: linear-gradient(135deg, #742a2a 0%, #9b2c2c 100%); border: 1px solid var(--danger); }
        .info-banner.danger p { color: #fed7d7; }
        .info-banner.info { background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%); border: 1px solid var(--accent); }
        .info-banner.info p { color: #bee3f8; }
        .info-banner p { font-size: 12px; margin: 0; }
        .info-banner .icon { font-size: 20px; }
        .toolbar { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; align-items: center; background: var(--bg-card); padding: 14px 18px; border-radius: 12px; border: 1px solid var(--border); }
        .toolbar-group { display: flex; align-items: center; gap: 8px; }
        .toolbar-group label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .toolbar select, .toolbar input[type="date"], .toolbar input[type="text"] { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; color: white; font-size: 12px; }
        .toolbar select:focus, .toolbar input:focus { outline: none; border-color: var(--accent); }
        .toolbar-btn { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; padding: 8px 14px; color: white; font-size: 12px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .toolbar-btn:hover { border-color: var(--accent); background: rgba(49,130,206,0.2); }
        .toolbar-btn.active { background: var(--accent); border-color: var(--accent); }
        .toolbar-spacer { flex: 1; }
        .category-filters { display: flex; gap: 8px; }
        .category-btn { padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s; border: 2px solid; display: flex; align-items: center; gap: 6px; }
        .category-btn .indicator { width: 8px; height: 8px; border-radius: 50%; }
        .category-btn.rolltech { border-color: var(--accent); color: var(--accent); background: transparent; }
        .category-btn.rolltech.active { background: var(--accent); color: white; }
        .category-btn.rolltech .indicator { background: var(--accent); }
        .category-btn.molding { border-color: var(--warning); color: var(--warning); background: transparent; }
        .category-btn.molding.active { background: var(--warning); color: #1a202c; }
        .category-btn.molding .indicator { background: var(--warning); }
        .category-btn:not(.active) { opacity: 0.5; }
        .category-btn:not(.active):hover { opacity: 0.8; }
        .status-filters { display: flex; gap: 6px; flex-wrap: wrap; }
        .status-btn { padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600; transition: all 0.2s; border: 1px solid; }
        .status-btn.pending { border-color: var(--warning); color: var(--warning); background: transparent; }
        .status-btn.pending.active { background: var(--warning); color: #1a202c; }
        .status-btn.staged { border-color: var(--staged-blue); color: var(--staged-blue); background: transparent; }
        .status-btn.staged.active { background: var(--staged-blue); color: white; }
        .status-btn.wip { border-color: var(--teal); color: var(--teal); background: transparent; }
        .status-btn.wip.active { background: var(--teal); color: white; }
        .status-btn.shipped { border-color: var(--success); color: var(--success); background: transparent; }
        .status-btn.shipped.active { background: var(--success); color: white; }
        .status-btn:not(.active) { opacity: 0.5; }
        .status-btn:not(.active):hover { opacity: 0.8; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; padding: 12px 10px; text-align: left; font-weight: 600; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; position: sticky; top: 0; white-space: nowrap; cursor: pointer; user-select: none; }
        .data-table th:hover { background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent) 100%); }
        .data-table th .sort-indicator { margin-left: 4px; opacity: 0.5; font-size: 9px; }
        .data-table th.sorted .sort-indicator { opacity: 1; color: var(--warning); }
        .data-table td { padding: 10px; border-bottom: 1px solid var(--border); font-size: 11px; }
        .data-table tr:hover td { background: rgba(255,255,255,0.04); }
        .data-table tr.clickable { cursor: pointer; }
        .data-table tr.clickable:hover td { background: rgba(49,130,206,0.15); }
        .data-table .positive { color: var(--success); font-weight: 600; }
        .data-table .negative { color: var(--danger); font-weight: 600; }
        .data-table .warning-text { color: var(--warning); font-weight: 600; }
        .scrollable-table { max-height: 600px; overflow-y: auto; overflow-x: auto; border-radius: 10px; }
        .scrollable-table::-webkit-scrollbar { width: 6px; height: 6px; }
        .scrollable-table::-webkit-scrollbar-track { background: var(--bg-dark); }
        .scrollable-table::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge.shipped { background: linear-gradient(135deg, var(--success) 0%, #2f855a 100%); color: white; }
        .badge.pending { background: linear-gradient(135deg, var(--warning) 0%, #b7791f 100%); color: #1a202c; }
        .badge.staged { background: linear-gradient(135deg, var(--staged-blue) 0%, #3182ce 100%); color: white; }
        .badge.wip { background: linear-gradient(135deg, var(--teal) 0%, #2c7a7b 100%); color: white; }
        .badge.urgent { background: linear-gradient(135deg, var(--danger) 0%, #c53030 100%); color: white; }
        .badge.forecast { background: linear-gradient(135deg, var(--purple) 0%, #6b46c1 100%); color: white; }
        .badge.priority-1 { background: var(--danger); color: white; }
        .badge.priority-2 { background: var(--warning); color: #1a202c; }
        .badge.priority-3 { background: var(--accent); color: white; }
        .badge.priority-4 { background: var(--teal); color: white; }
        .cell-missing { color: var(--danger); font-weight: 600; }
        .cell-available { color: var(--success); }
        .chart-container { background: linear-gradient(135deg, var(--bg-card) 0%, #374151 100%); border-radius: 14px; padding: 20px; border: 1px solid var(--border); margin-bottom: 20px; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 10px; }
        .chart-header h3 { font-size: 16px; font-weight: 600; }
        .chart-wrapper { position: relative; height: 280px; }
        .chart-wrapper.large { height: 350px; }
        .search-box { background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; color: white; font-size: 13px; min-width: 180px; transition: all 0.2s; }
        .search-box:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(49,130,206,0.2); }
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; text-align: center; }
        .spinner { width: 45px; height: 45px; border: 4px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .mobile-header { display: none; align-items: center; justify-content: space-between; padding: 14px 16px; background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%); position: sticky; top: 0; z-index: 1001; }
        .mobile-header h1 { font-size: 18px; }
        .menu-toggle { background: rgba(255,255,255,0.15); border: none; color: white; font-size: 22px; width: 40px; height: 40px; border-radius: 8px; cursor: pointer; }
        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 999; }
        .sidebar-overlay.active { display: block; }
        .watchlist-star { cursor: pointer; font-size: 14px; color: var(--text-secondary); transition: all 0.2s; }
        .watchlist-star:hover { color: var(--warning); transform: scale(1.2); }
        .watchlist-star.active { color: var(--warning); }
        .drilldown-section { display: none; margin-top: 20px; background: var(--bg-card); border-radius: 14px; padding: 20px; border: 1px solid var(--border); }
        .drilldown-section.active { display: block; }
        .drilldown-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 10px; }
        .drilldown-header h3 { font-size: 18px; }
        .breadcrumb { font-size: 11px; color: var(--text-secondary); margin-bottom: 4px; }
        .close-btn { background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 11px; }
        .close-btn:hover { border-color: var(--danger); color: var(--danger); }
        .back-btn { background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 11px; margin-right: 8px; }
        .back-btn:hover { border-color: var(--accent); color: var(--accent); }
        .summary-row { display: flex; gap: 20px; margin-bottom: 16px; flex-wrap: wrap; }
        .summary-item { background: var(--bg-dark); padding: 12px 16px; border-radius: 8px; }
        .summary-item .label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; }
        .summary-item .value { font-size: 18px; font-weight: 700; }
        .price-history-container { background: var(--bg-dark); border-radius: 10px; padding: 16px; margin-bottom: 16px; }
        .price-history-container canvas { max-height: 200px; }
        .tabs { display: flex; gap: 8px; margin-bottom: 16px; }
        .tab { padding: 10px 20px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s; }
        .tab:hover { border-color: var(--accent); }
        .tab.active { background: linear-gradient(135deg, var(--accent) 0%, #4299e1 100%); border-color: var(--accent); }
        .bom-grid { display: grid; grid-template-columns: 260px 1fr; gap: 20px; }
        .bom-selector { max-height: 450px; overflow-y: auto; padding: 12px; background: var(--bg-dark); border-radius: 10px; }
        .bom-item { padding: 10px 14px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.2s; font-size: 12px; margin-bottom: 6px; }
        .bom-item:hover { border-color: var(--accent); transform: translateX(4px); }
        .bom-item.selected { border-color: var(--accent); background: linear-gradient(135deg, var(--accent) 0%, #4299e1 100%); }
        .bom-details { background: var(--bg-card); border-radius: 14px; padding: 20px; border: 1px solid var(--border); }
        .bom-header { border-bottom: 1px solid var(--border); padding-bottom: 14px; margin-bottom: 16px; }
        .bom-header h3 { font-size: 20px; margin-bottom: 6px; }
        .bom-header .category { color: var(--accent); font-size: 13px; font-weight: 500; }
        .bom-section { margin-bottom: 20px; }
        .bom-section h4 { font-size: 11px; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 10px; letter-spacing: 0.8px; font-weight: 700; }
        .component-list { display: grid; gap: 8px; }
        .component-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 14px; background: var(--bg-dark); border-radius: 8px; flex-wrap: wrap; gap: 8px; }
        .component-item .name { font-weight: 600; font-size: 12px; }
        .component-item .details { display: flex; gap: 14px; color: var(--text-secondary); font-size: 11px; }
        .cost-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
        .cost-item { display: flex; justify-content: space-between; padding: 10px 14px; background: var(--bg-dark); border-radius: 8px; font-size: 12px; }
        .cost-item .label { color: var(--text-secondary); }
        .cost-item .value { font-weight: 600; }
        .highlight-box { background: linear-gradient(135deg, var(--accent) 0%, #4299e1 100%); border-radius: 10px; padding: 16px; margin-top: 14px; display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 12px; text-align: center; }
        .highlight-box .item .value { font-size: 20px; font-weight: 700; }
        .highlight-box .item .label { font-size: 10px; opacity: 0.85; margin-top: 3px; }
        .inv-low { background: rgba(229,62,62,0.15) !important; }
        .inv-warning { background: rgba(214,158,46,0.15) !important; }
        .inv-ok { background: rgba(56,161,105,0.08) !important; }
        @media (max-width: 1200px) { .quick-stats { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 1024px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .grid-2 { grid-template-columns: 1fr; } .quick-stats { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 16px; }
            .mobile-header { display: flex; }
            .dept-grid { grid-template-columns: 1fr; }
            .quick-stats { grid-template-columns: 1fr 1fr; }
            .toolbar { flex-direction: column; align-items: stretch; }
            .toolbar-spacer { display: none; }
            .bom-grid { grid-template-columns: 1fr; }
            .tabs { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <div class="mobile-header">
        <div><h1>Roll Tech</h1><span style="font-size:10px;color:var(--text-secondary);">Operations</span></div>
        <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
    </div>
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div class="sidebar">
        <div class="logo"><h1>Roll Tech</h1><span id="logoSubtitle">Operations Dashboard</span></div>
        <div class="lang-toggle">
            <button class="lang-btn active" id="langEN" onclick="setLanguage('en')">English</button>
            <button class="lang-btn" id="langES" onclick="setLanguage('es')">Espa√±ol</button>
        </div>
        <div class="nav-section">
            <div class="nav-item active" data-page="main" onclick="navigateTo('main')"><span class="icon">üè†</span> <span data-i18n="nav.main">Main Dashboard</span></div>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section">
            <div class="nav-section-title" data-i18n="nav.production">Production</div>
            <div class="nav-item" data-page="orders-data" onclick="navigateTo('orders-data')"><span class="icon">üìã</span> <span data-i18n="nav.ordersData">Orders Data</span></div>
            <div class="nav-item sub-item" data-page="orders-queue" onclick="navigateTo('orders-queue')"><span class="icon">üîß</span> <span data-i18n="nav.ordersQueue">Need to Make</span></div>
            <div class="nav-item sub-item" data-page="orders-staged" onclick="navigateTo('orders-staged')"><span class="icon">üì¶</span> <span data-i18n="nav.ordersStaged">Ready to Ship</span></div>
            <div class="nav-item sub-item" data-page="orders-shipped" onclick="navigateTo('orders-shipped')"><span class="icon">üöö</span> <span data-i18n="nav.ordersShipped">Shipped</span></div>
            <div class="nav-item" data-page="inventory" onclick="navigateTo('inventory')"><span class="icon">üì¶</span> <span data-i18n="nav.inventory">Inventory</span></div>
        </div>
        <div class="nav-section">
            <div class="nav-section-title" data-i18n="nav.salesFinance">Sales &amp; Finance</div>
            <div class="nav-item" data-page="sales-overview" onclick="navigateTo('sales-overview')"><span class="icon">üìä</span> <span data-i18n="nav.plOverview">P/L Overview</span></div>
            <div class="nav-item sub-item" data-page="sales-parts" onclick="navigateTo('sales-parts')"><span class="icon">üîß</span> <span data-i18n="nav.byPart">By Part Number</span></div>
            <div class="nav-item sub-item" data-page="sales-customers" onclick="navigateTo('sales-customers')"><span class="icon">üë•</span> <span data-i18n="nav.byCustomer">By Customer</span></div>
            <div class="nav-item sub-item" data-page="sales-dates" onclick="navigateTo('sales-dates')"><span class="icon">üìÖ</span> <span data-i18n="nav.byDate">By Date</span></div>
        </div>
        <div class="nav-section">
            <div class="nav-section-title" data-i18n="nav.billOfMaterials">Bill of Materials</div>
            <div class="nav-item" data-page="bom" onclick="navigateTo('bom')"><span class="icon">üìã</span> <span data-i18n="nav.bomExplorer">BOM Explorer</span></div>
        </div>
        <div class="data-info" id="dataInfo"><strong>Loading...</strong></div>
    </div>

    <div class="main-content">
        <div id="loadingState" class="loading"><div class="spinner"></div><p style="margin-top:18px;color:var(--text-secondary);" data-i18n="loading">Loading data from Google Sheets...</p></div>

        <!-- MAIN DASHBOARD -->
        <div id="main" class="page">
            <div class="page-header">
                <div><h2 data-i18n="main.title">Operations Dashboard</h2><p data-i18n="main.subtitle">Real-time overview of Roll Tech manufacturing operations</p></div>
                <div class="last-updated"><span class="dot"></span><span id="lastUpdated">Loading...</span></div>
            </div>
            <div class="quick-stats">
                <div class="quick-stat"><div class="value warning" id="qsNeedToMake">-</div><div class="label" data-i18n="stats.needToMake">Need to Make</div></div>
                <div class="quick-stat"><div class="value" id="qsUrgentOrders">-</div><div class="label" data-i18n="stats.urgent">Urgent</div></div>
                <div class="quick-stat"><div class="value" id="qsTotalQty">-</div><div class="label" data-i18n="stats.totalUnits">Total Units</div></div>
                <div class="quick-stat"><div class="value positive" id="qsMonthlyRevenue">-</div><div class="label" data-i18n="stats.monthRevenue">Month Revenue</div></div>
                <div class="quick-stat"><div class="value" id="qsMonthlyPL">-</div><div class="label" data-i18n="stats.monthPL">Month P/L</div></div>
                <div class="quick-stat"><div class="value warning" id="qsMissingComponents">-</div><div class="label" data-i18n="stats.missingParts">Missing Parts</div></div>
            </div>
            <div class="dept-grid">
                <div class="dept-card production" onclick="navigateTo('orders-queue')">
                    <div class="icon-large">üè≠</div>
                    <h3 data-i18n="dept.production">Production Planning</h3>
                    <p data-i18n="dept.productionDesc">View orders to make, component status, and production queue</p>
                    <div class="metrics">
                        <div class="metric"><div class="value" id="deptProdOrders">-</div><div class="label" data-i18n="dept.needToMake">Need to Make</div></div>
                        <div class="metric"><div class="value" id="deptProdUnits">-</div><div class="label" data-i18n="dept.units">Units</div></div>
                        <div class="metric"><div class="value warning" id="deptProdUrgent">-</div><div class="label" data-i18n="stats.urgent">Urgent</div></div>
                    </div>
                </div>
                <div class="dept-card sales" onclick="navigateTo('sales-overview')">
                    <div class="icon-large">üí∞</div>
                    <h3 data-i18n="dept.sales">Sales &amp; P/L Analytics</h3>
                    <p data-i18n="dept.salesDesc">Revenue, profitability, and customer analysis</p>
                    <div class="metrics">
                        <div class="metric"><div class="value positive" id="deptSalesRev">-</div><div class="label" data-i18n="dept.revenue">Revenue</div></div>
                        <div class="metric"><div class="value" id="deptSalesPL">-</div><div class="label" data-i18n="dept.profit">Profit</div></div>
                        <div class="metric"><div class="value" id="deptSalesOrders">-</div><div class="label" data-i18n="dept.orders">Orders</div></div>
                    </div>
                </div>
                <div class="dept-card inventory" onclick="navigateTo('inventory')">
                    <div class="icon-large">üì¶</div>
                    <h3 data-i18n="dept.inventory">Inventory Management</h3>
                    <p data-i18n="dept.inventoryDesc">Stock levels, reorder points, and material tracking</p>
                </div>
            </div>
            <div class="grid-2">
                <div class="chart-container">
                    <div class="chart-header"><h3 data-i18n="chart.ordersByStatus">Orders by Status</h3></div>
                    <div class="chart-wrapper"><canvas id="mainStatusChart"></canvas></div>
                </div>
                <div class="chart-container">
                    <div class="chart-header"><h3 data-i18n="chart.upcomingDeadlines">Upcoming Deadlines (Next 14 Days)</h3></div>
                    <div class="chart-wrapper"><canvas id="mainDeadlineChart"></canvas></div>
                </div>
            </div>
        </div>

        <!-- ORDERS DATA PAGE -->
        <div id="orders-data" class="page">
            <div class="page-header">
                <div><h2 data-i18n="ordersData.title">All Orders Data</h2><p data-i18n="ordersData.subtitle">Complete order database with all statuses</p></div>
                <div style="display:flex;gap:10px;align-items:center;">
                    <button class="toolbar-btn" onclick="navigateTo('main')">‚Üê <span data-i18n="btn.backToDashboard">Back</span></button>
                    <div class="last-updated"><span class="dot"></span><span id="ordersDataLastUpdated">-</span></div>
                </div>
            </div>
            <div class="toolbar">
                <div class="toolbar-group category-filters">
                    <label>Category:</label>
                    <button class="category-btn rolltech active" id="ordersDataBtnRollTech" onclick="toggleOrdersDataCategory('rolltech')"><span class="indicator"></span> Roll Tech</button>
                    <button class="category-btn molding" id="ordersDataBtnMolding" onclick="toggleOrdersDataCategory('molding')"><span class="indicator"></span> Molding</button>
                </div>
                <div class="toolbar-group status-filters">
                    <label>Status:</label>
                    <button class="status-btn pending active" id="ordersDataStatusPending" onclick="toggleOrdersDataStatus('pending')"><span data-i18n="status.needToMake">Need to Make</span></button>
                    <button class="status-btn wip active" id="ordersDataStatusWip" onclick="toggleOrdersDataStatus('wip')"><span data-i18n="status.making">Making</span></button>
                    <button class="status-btn staged active" id="ordersDataStatusStaged" onclick="toggleOrdersDataStatus('staged')"><span data-i18n="status.readyToShip">Ready to Ship</span></button>
                    <button class="status-btn shipped" id="ordersDataStatusShipped" onclick="toggleOrdersDataStatus('shipped')"><span data-i18n="status.shipped">Shipped</span></button>
                </div>
                <div class="toolbar-spacer"></div>
                <input type="text" class="search-box" id="ordersDataSearch" placeholder="Search..." oninput="filterOrdersDataTable()">
                <button class="toolbar-btn" onclick="exportOrdersDataToCSV()">üì• Export</button>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="label">Total Orders</div><div class="value" id="ordersDataTotalOrders">-</div><div class="sub" id="ordersDataTotalUnits">- units</div></div>
                <div class="stat-card"><div class="label" data-i18n="stats.needToMake">Need to Make</div><div class="value warning" id="ordersDataNeedToMake">-</div></div>
                <div class="stat-card"><div class="label" data-i18n="stats.making">Making</div><div class="value" style="color:var(--teal);" id="ordersDataMaking">-</div></div>
                <div class="stat-card"><div class="label" data-i18n="stats.readyToShip">Ready to Ship</div><div class="value positive" id="ordersDataReadyToShip">-</div></div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Orders</h3><span style="color:var(--text-secondary);font-size:12px;" id="ordersDataTableCount">-</span></div>
                <div class="scrollable-table">
                    <table class="data-table" id="ordersDataTable"><thead><tr id="ordersDataTableHeader"></tr></thead><tbody id="ordersDataTableBody"></tbody></table>
                </div>
            </div>
        </div>

        <!-- ORDERS QUEUE PAGE -->
        <div id="orders-queue" class="page">
            <div class="page-header">
                <div><h2 data-i18n="ordersQueue.title">Orders Queue - Need to Make</h2><p data-i18n="ordersQueue.subtitle">Orders pending production (Pending + Approved status)</p></div>
                <div style="display:flex;gap:10px;align-items:center;">
                    <button class="toolbar-btn" onclick="navigateTo('main')">‚Üê Back</button>
                    <div class="last-updated"><span class="dot"></span><span id="ordersQueueLastUpdated">-</span></div>
                </div>
            </div>
            <div class="toolbar">
                <div class="toolbar-group category-filters">
                    <label>Category:</label>
                    <button class="category-btn rolltech active" id="ordersQueueBtnRollTech" onclick="toggleOrdersQueueCategory('rolltech')"><span class="indicator"></span> Roll Tech</button>
                    <button class="category-btn molding" id="ordersQueueBtnMolding" onclick="toggleOrdersQueueCategory('molding')"><span class="indicator"></span> Molding</button>
                </div>
                <div class="toolbar-spacer"></div>
                <input type="text" class="search-box" id="ordersQueueSearch" placeholder="Search..." oninput="filterOrdersQueueTable()">
                <button class="toolbar-btn" onclick="exportOrdersQueueToCSV()">üì• Export</button>
            </div>
            <div class="info-banner warning" id="ordersQueueMissingBanner">
                <span class="icon">‚ö†Ô∏è</span>
                <p><strong id="ordersQueueMissingCount">0</strong> <span data-i18n="prod.missingMsg">orders have missing components.</span></p>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="label">Total Orders</div><div class="value" id="ordersQueueTotalOrders">-</div><div class="sub" id="ordersQueueTotalUnits">- units</div></div>
                <div class="stat-card"><div class="label">Urgent</div><div class="value negative" id="ordersQueueUrgentCount">-</div></div>
                <div class="stat-card"><div class="label">Due This Week</div><div class="value warning" id="ordersQueueDueWeek">-</div><div class="sub" id="ordersQueueDueWeekUnits">- units</div></div>
                <div class="stat-card"><div class="label">Components Ready</div><div class="value positive" id="ordersQueueComponentsReady">-</div></div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Orders to Make</h3><span style="color:var(--text-secondary);font-size:12px;" id="ordersQueueTableCount">-</span></div>
                <div class="scrollable-table">
                    <table class="data-table"><thead><tr id="ordersQueueTableHeader"></tr></thead><tbody id="ordersQueueTableBody"></tbody></table>
                </div>
            </div>
        </div>

        <!-- ORDERS STAGED PAGE -->
        <div id="orders-staged" class="page">
            <div class="page-header">
                <div><h2 data-i18n="ordersStaged.title">Staged Orders - Ready to Ship</h2></div>
                <button class="toolbar-btn" onclick="navigateTo('main')">‚Üê Back</button>
            </div>
            <div class="toolbar">
                <div class="toolbar-group category-filters">
                    <label>Category:</label>
                    <button class="category-btn rolltech active" id="ordersStagedBtnRollTech" onclick="toggleOrdersStagedCategory('rolltech')"><span class="indicator"></span> Roll Tech</button>
                    <button class="category-btn molding" id="ordersStagedBtnMolding" onclick="toggleOrdersStagedCategory('molding')"><span class="indicator"></span> Molding</button>
                </div>
                <div class="toolbar-spacer"></div>
                <input type="text" class="search-box" id="ordersStagedSearch" placeholder="Search..." oninput="filterOrdersStagedTable()">
                <button class="toolbar-btn" onclick="exportOrdersStagedToCSV()">üì• Export</button>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="label">Staged Orders</div><div class="value" id="ordersStagedTotalOrders">-</div><div class="sub" id="ordersStagedTotalUnits">- units</div></div>
                <div class="stat-card"><div class="label">Total Revenue</div><div class="value positive" id="ordersStagedRevenue">-</div></div>
                <div class="stat-card"><div class="label">Avg Order Value</div><div class="value" id="ordersStagedAvgValue">-</div></div>
                <div class="stat-card"><div class="label">Customers</div><div class="value" id="ordersStagedCustomers">-</div></div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Ready to Ship</h3><span style="color:var(--text-secondary);font-size:12px;" id="ordersStagedTableCount">-</span></div>
                <div class="scrollable-table">
                    <table class="data-table"><thead><tr id="ordersStagedTableHeader"></tr></thead><tbody id="ordersStagedTableBody"></tbody></table>
                </div>
            </div>
        </div>

        <!-- ORDERS SHIPPED PAGE -->
        <div id="orders-shipped" class="page">
            <div class="page-header">
                <div><h2 data-i18n="ordersShipped.title">Shipped Orders History</h2></div>
                <button class="toolbar-btn" onclick="navigateTo('main')">‚Üê Back</button>
            </div>
            <div class="toolbar">
                <div class="toolbar-group category-filters">
                    <label>Category:</label>
                    <button class="category-btn rolltech active" id="ordersShippedBtnRollTech" onclick="toggleOrdersShippedCategory('rolltech')"><span class="indicator"></span> Roll Tech</button>
                    <button class="category-btn molding" id="ordersShippedBtnMolding" onclick="toggleOrdersShippedCategory('molding')"><span class="indicator"></span> Molding</button>
                </div>
                <div class="toolbar-group">
                    <label>From:</label><input type="date" id="ordersShippedFromDate" onchange="applyShippedDateFilter()">
                </div>
                <div class="toolbar-group">
                    <label>To:</label><input type="date" id="ordersShippedToDate" onchange="applyShippedDateFilter()">
                </div>
                <button class="toolbar-btn" onclick="resetShippedDateFilter()">üîÑ Reset</button>
                <div class="toolbar-spacer"></div>
                <input type="text" class="search-box" id="ordersShippedSearch" placeholder="Search..." oninput="filterOrdersShippedTable()">
                <button class="toolbar-btn" onclick="exportOrdersShippedToCSV()">üì• Export</button>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="label">Shipped Orders</div><div class="value" id="ordersShippedTotalOrders">-</div><div class="sub" id="ordersShippedTotalUnits">- units</div></div>
                <div class="stat-card"><div class="label">Total Revenue</div><div class="value positive" id="ordersShippedRevenue">-</div></div>
                <div class="stat-card"><div class="label">Total P/L</div><div class="value" id="ordersShippedPL">-</div><div class="sub" id="ordersShippedMargin">Margin: -%</div></div>
                <div class="stat-card"><div class="label">Customers</div><div class="value" id="ordersShippedCustomers">-</div></div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Shipped Orders</h3><span style="color:var(--text-secondary);font-size:12px;" id="ordersShippedTableCount">-</span></div>
                <div class="scrollable-table">
                    <table class="data-table"><thead><tr id="ordersShippedTableHeader"></tr></thead><tbody id="ordersShippedTableBody"></tbody></table>
                </div>
            </div>
        </div>

        <!-- INVENTORY PAGE -->
        <div id="inventory" class="page">
            <div class="page-header">
                <div><h2 data-i18n="inv.title">Inventory Management</h2></div>
            </div>
            <div class="toolbar">
                <input type="text" class="search-box" id="invSearch" placeholder="Search items..." oninput="filterInvTable()">
                <div class="toolbar-group">
                    <button class="toolbar-btn active" id="invFilterAll" onclick="setInvFilter('all')">All</button>
                    <button class="toolbar-btn" id="invFilterLow" onclick="setInvFilter('low')">‚ö†Ô∏è Low Stock</button>
                    <button class="toolbar-btn" id="invFilterNeeded" onclick="setInvFilter('needed')">üîß Needs Production</button>
                </div>
                <div class="toolbar-spacer"></div>
                <button class="toolbar-btn" onclick="exportInvCSV()">üì• Export</button>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="label">Total Items</div><div class="value" id="invStatTotal">-</div><div class="sub" id="invStatTypes">- product types</div></div>
                <div class="stat-card"><div class="label">Low Stock</div><div class="value" style="color:var(--danger);" id="invStatLow">-</div></div>
                <div class="stat-card"><div class="label">Needs Production</div><div class="value" style="color:var(--warning);" id="invStatNeeded">-</div></div>
                <div class="stat-card"><div class="label">Adequate Stock</div><div class="value" style="color:var(--success);" id="invStatOk">-</div></div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Inventory Status</h3><span style="color:var(--text-secondary);font-size:12px;" id="invTableCount">-</span></div>
                <div class="scrollable-table">
                    <table class="data-table" id="invTable">
                        <thead><tr>
                            <th onclick="sortInvTable('product')">Product Type</th>
                            <th onclick="sortInvTable('partNumber')">Part Number</th>
                            <th onclick="sortInvTable('fusionQty')">Fusion Qty</th>
                            <th onclick="sortInvTable('minimum')">Minimum</th>
                            <th onclick="sortInvTable('manualTarget')">Manual Target</th>
                            <th onclick="sortInvTable('qtyNeeded')">Qty Needed</th>
                            <th onclick="sortInvTable('partsToBeMade')">Parts to Make</th>
                            <th onclick="sortInvTable('moldType')">Mold Type</th>
                            <th>Status</th>
                        </tr></thead>
                        <tbody id="invTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- SALES OVERVIEW PAGE -->
        <div id="sales-overview" class="page">
            <div class="page-header">
                <div><h2 data-i18n="sales.title">P/L Overview</h2></div>
                <button class="toolbar-btn" onclick="navigateTo('main')">‚Üê Back</button>
            </div>
            <div class="info-banner danger" id="salesCriticalBanner">
                <span class="icon">üö®</span>
                <p><strong>Critical Loss Parts:</strong> <span id="salesCriticalText">-</span></p>
            </div>
            <div class="toolbar">
                <div class="toolbar-group category-filters">
                    <label>Category:</label>
                    <button class="category-btn rolltech active" id="salesBtnRollTech" onclick="toggleSalesCategory('rolltech')"><span class="indicator"></span> Roll Tech</button>
                    <button class="category-btn molding" id="salesBtnMolding" onclick="toggleSalesCategory('molding')"><span class="indicator"></span> Molding</button>
                </div>
                <div class="toolbar-spacer"></div>
                <button class="toolbar-btn" onclick="exportSalesCSV()">üì• Export</button>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="label">Total Revenue</div><div class="value" id="salesStatRevenue">-</div><div class="sub" id="salesStatOrderCount">- orders</div></div>
                <div class="stat-card"><div class="label">Total P/L</div><div class="value" id="salesStatPL">-</div><div class="sub" id="salesStatMargin">Margin: -%</div></div>
                <div class="stat-card"><div class="label">Shipped P/L</div><div class="value" id="salesStatShippedPL">-</div><div class="sub" id="salesStatShippedCount">- shipped</div></div>
                <div class="stat-card"><div class="label">Forecasted P/L</div><div class="value" id="salesStatForecastPL">-</div><div class="sub" id="salesStatForecastCount">- pending</div></div>
            </div>
            <div class="grid-2">
                <div class="chart-container">
                    <div class="chart-header"><h3>Top 10 P/L Impact</h3></div>
                    <div class="chart-wrapper large"><canvas id="salesLossesChart"></canvas></div>
                </div>
                <div class="chart-container">
                    <div class="chart-header"><h3>Customer P/L Distribution (Top 8)</h3></div>
                    <div class="chart-wrapper large"><canvas id="salesCustomerPieChart"></canvas></div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Monthly P/L Trend</h3></div>
                <div class="chart-wrapper large"><canvas id="salesTrendChart"></canvas></div>
            </div>
        </div>

        <!-- SALES BY PARTS PAGE -->
        <div id="sales-parts" class="page">
            <div class="page-header">
                <div><h2>P/L by Part Number</h2></div>
                <button class="toolbar-btn" onclick="navigateTo('sales-overview')">‚Üê Back</button>
            </div>
            <div class="toolbar">
                <div class="toolbar-group category-filters">
                    <label>Category:</label>
                    <button class="category-btn rolltech active" id="partsBtnRollTech" onclick="togglePartsCategory('rolltech')"><span class="indicator"></span> Roll Tech</button>
                    <button class="category-btn molding" id="partsBtnMolding" onclick="togglePartsCategory('molding')"><span class="indicator"></span> Molding</button>
                </div>
                <div class="toolbar-group">
                    <label>From:</label><input type="date" id="partsFromDate" onchange="applyPartsDateFilter()">
                </div>
                <div class="toolbar-group">
                    <label>To:</label><input type="date" id="partsToDate" onchange="applyPartsDateFilter()">
                </div>
                <button class="toolbar-btn" onclick="resetPartsDateFilter()">üîÑ Clear Dates</button>
                <button class="toolbar-btn" id="partsWatchlistBtn" onclick="togglePartsWatchlistFilter()">‚≠ê Watchlist</button>
                <div class="toolbar-spacer"></div>
                <input type="text" class="search-box" id="partsSearch" placeholder="Search parts..." oninput="filterPartsTable()">
                <button class="toolbar-btn" onclick="exportPartsCSV()">üì• Export</button>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Parts P/L Analysis (Top 30)</h3></div>
                <div class="chart-wrapper large"><canvas id="partsBarChart"></canvas></div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Parts Details</h3><span style="color:var(--text-secondary);font-size:12px;" id="partsTableCount">-</span></div>
                <div class="scrollable-table">
                    <table class="data-table"><thead><tr id="partsTableHeader"></tr></thead><tbody id="partsTableBody"></tbody></table>
                </div>
            </div>
            <!-- Parts Customer Drilldown (Level 1) -->
            <div class="drilldown-section" id="partsCustomerDrilldown">
                <div class="drilldown-header">
                    <div>
                        <div class="breadcrumb">Parts ‚Ä∫ <span id="partsCustomerDrilldownPart">-</span></div>
                        <h3>Customer Breakdown</h3>
                    </div>
                    <button class="close-btn" onclick="closePartsCustomerDrilldown()">‚úï Close</button>
                </div>
                <div class="summary-row" id="partsCustomerSummary"></div>
                <div class="scrollable-table">
                    <table class="data-table">
                        <thead><tr><th>Customer</th><th>Qty</th><th>Unit Price</th><th>Contribution</th><th>Margin</th><th>P/L</th><th>Revenue</th></tr></thead>
                        <tbody id="partsCustomerDrilldownBody"></tbody>
                    </table>
                </div>
            </div>
            <!-- Parts Orders Drilldown (Level 2) -->
            <div class="drilldown-section" id="partsOrdersDrilldown">
                <div class="drilldown-header">
                    <div>
                        <div class="breadcrumb">Parts ‚Ä∫ <span id="partsOrdersBreadcrumbPart">-</span> ‚Ä∫ <span id="partsOrdersBreadcrumbCustomer">-</span></div>
                        <h3>Orders &amp; Price History</h3>
                    </div>
                    <div>
                        <button class="back-btn" onclick="backToPartsCustomers()">‚Üê Back</button>
                        <button class="close-btn" onclick="closeAllPartsDrilldowns()">‚úï Close All</button>
                    </div>
                </div>
                <div class="summary-row" id="partsOrdersSummary"></div>
                <div class="price-history-container">
                    <h4 style="font-size:11px;color:var(--text-secondary);margin-bottom:8px;">PRICE HISTORY</h4>
                    <canvas id="partsOrdersPriceChart"></canvas>
                </div>
                <div class="scrollable-table">
                    <table class="data-table">
                        <thead><tr><th>PO #</th><th>Status</th><th>Qty</th><th>Unit Price</th><th>Contribution</th><th>Profit/Part</th><th>P/L</th><th>Revenue</th><th>Date</th></tr></thead>
                        <tbody id="partsOrdersDrilldownBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- SALES BY CUSTOMERS PAGE -->
        <div id="sales-customers" class="page">
            <div class="page-header">
                <div><h2>P/L by Customer</h2></div>
                <button class="toolbar-btn" onclick="navigateTo('sales-overview')">‚Üê Back</button>
            </div>
            <div class="toolbar">
                <div class="toolbar-group category-filters">
                    <label>Category:</label>
                    <button class="category-btn rolltech active" id="customersBtnRollTech" onclick="toggleCustomersCategory('rolltech')"><span class="indicator"></span> Roll Tech</button>
                    <button class="category-btn molding" id="customersBtnMolding" onclick="toggleCustomersCategory('molding')"><span class="indicator"></span> Molding</button>
                </div>
                <div class="toolbar-group">
                    <label>From:</label><input type="date" id="customersFromDate" onchange="applyCustomersDateFilter()">
                </div>
                <div class="toolbar-group">
                    <label>To:</label><input type="date" id="customersToDate" onchange="applyCustomersDateFilter()">
                </div>
                <button class="toolbar-btn" onclick="resetCustomersDateFilter()">üîÑ Clear Dates</button>
                <button class="toolbar-btn" id="customersWatchlistBtn" onclick="toggleCustomersWatchlistFilter()">‚≠ê Watchlist</button>
                <div class="toolbar-spacer"></div>
                <input type="text" class="search-box" id="customersSearch" placeholder="Search customers..." oninput="filterCustomersTable()">
                <button class="toolbar-btn" onclick="exportCustomersCSV()">üì• Export</button>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Customer P/L Distribution (Top 10)</h3></div>
                <div class="chart-wrapper large"><canvas id="customersChart"></canvas></div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Customer Details</h3><span style="color:var(--text-secondary);font-size:12px;" id="customersTableCount">-</span></div>
                <div class="scrollable-table">
                    <table class="data-table"><thead><tr id="customersTableHeader"></tr></thead><tbody id="customersTableBody"></tbody></table>
                </div>
            </div>
            <!-- Customers Product Drilldown (Level 1) -->
            <div class="drilldown-section" id="customersProductDrilldown">
                <div class="drilldown-header">
                    <div>
                        <div class="breadcrumb">Customers ‚Ä∫ <span id="customersProductDrilldownCustomer">-</span></div>
                        <h3>Product Breakdown</h3>
                    </div>
                    <button class="close-btn" onclick="closeCustomersProductDrilldown()">‚úï Close</button>
                </div>
                <div class="summary-row" id="customersProductSummary"></div>
                <div class="scrollable-table">
                    <table class="data-table">
                        <thead><tr><th>Part Number</th><th>Qty</th><th>Unit Price</th><th>Contribution</th><th>Margin</th><th>P/L</th><th>Revenue</th></tr></thead>
                        <tbody id="customersProductDrilldownBody"></tbody>
                    </table>
                </div>
            </div>
            <!-- Customers Orders Drilldown (Level 2) -->
            <div class="drilldown-section" id="customersOrdersDrilldown">
                <div class="drilldown-header">
                    <div>
                        <div class="breadcrumb">Customers ‚Ä∫ <span id="customersOrdersBreadcrumbCustomer">-</span> ‚Ä∫ <span id="customersOrdersBreadcrumbPart">-</span></div>
                        <h3>Orders Breakdown</h3>
                    </div>
                    <div>
                        <button class="back-btn" onclick="backToCustomersProducts()">‚Üê Back</button>
                        <button class="close-btn" onclick="closeAllCustomersDrilldowns()">‚úï Close All</button>
                    </div>
                </div>
                <div class="summary-row" id="customersOrdersSummary"></div>
                <div class="scrollable-table">
                    <table class="data-table">
                        <thead><tr><th>PO #</th><th>Status</th><th>Qty</th><th>Unit Price</th><th>Contribution</th><th>Profit/Part</th><th>P/L</th><th>Revenue</th><th>Date</th></tr></thead>
                        <tbody id="customersOrdersDrilldownBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- SALES BY DATE PAGE -->
        <div id="sales-dates" class="page">
            <div class="page-header">
                <div><h2>P/L by Date</h2></div>
                <button class="toolbar-btn" onclick="navigateTo('sales-overview')">‚Üê Back</button>
            </div>
            <div class="toolbar">
                <div class="toolbar-group category-filters">
                    <label>Category:</label>
                    <button class="category-btn rolltech active" id="datesBtnRollTech" onclick="toggleDatesCategory('rolltech')"><span class="indicator"></span> Roll Tech</button>
                    <button class="category-btn molding" id="datesBtnMolding" onclick="toggleDatesCategory('molding')"><span class="indicator"></span> Molding</button>
                </div>
                <div class="toolbar-group">
                    <label>From:</label><input type="date" id="datesFromDate" onchange="applyDatesDateFilter()">
                </div>
                <div class="toolbar-group">
                    <label>To:</label><input type="date" id="datesToDate" onchange="applyDatesDateFilter()">
                </div>
                <button class="toolbar-btn" onclick="resetDatesDateFilter()">üîÑ Clear Dates</button>
                <div class="toolbar-spacer"></div>
                <button class="toolbar-btn" onclick="exportDatesCSV()">üì• Export</button>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="label">Orders</div><div class="value" id="datesStatOrders">-</div><div class="sub" id="datesStatUnits">- units</div></div>
                <div class="stat-card"><div class="label">Revenue</div><div class="value" id="datesStatRevenue">-</div></div>
                <div class="stat-card"><div class="label">P/L</div><div class="value" id="datesStatPL">-</div><div class="sub" id="datesStatMargin">Margin: -%</div></div>
                <div class="stat-card"><div class="label">Margin</div><div class="value" id="datesStatMarginPct">-</div><div class="sub" id="datesStatMonths">- months</div></div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Monthly P/L Breakdown</h3></div>
                <div class="chart-wrapper large"><canvas id="datesBarChart"></canvas></div>
            </div>
            <div class="chart-container">
                <div class="chart-header"><h3>Monthly Details</h3><span style="color:var(--text-secondary);font-size:12px;" id="datesTableCount">-</span></div>
                <div class="scrollable-table">
                    <table class="data-table"><thead><tr><th>Month</th><th>Status</th><th>Orders</th><th>Qty</th><th>Revenue</th><th>P/L</th><th>Margin</th></tr></thead><tbody id="datesTableBody"></tbody></table>
                </div>
            </div>
            <!-- Dates Customer Drilldown (Level 1) -->
            <div class="drilldown-section" id="datesCustomerDrilldown">
                <div class="drilldown-header">
                    <div>
                        <div class="breadcrumb">Months ‚Ä∫ <span id="datesCustomerDrilldownMonth">-</span></div>
                        <h3>Customer Breakdown</h3>
                    </div>
                    <button class="close-btn" onclick="closeDatesCustomerDrilldown()">‚úï Close</button>
                </div>
                <div class="summary-row" id="datesCustomerSummary"></div>
                <div class="scrollable-table">
                    <table class="data-table">
                        <thead><tr><th>Customer</th><th>Orders</th><th>Quantity</th><th>Revenue</th><th>P/L</th><th>Margin</th></tr></thead>
                        <tbody id="datesCustomerDrilldownBody"></tbody>
                    </table>
                </div>
            </div>
            <!-- Dates Orders Drilldown (Level 2) -->
            <div class="drilldown-section" id="datesOrdersDrilldown">
                <div class="drilldown-header">
                    <div>
                        <div class="breadcrumb">Months ‚Ä∫ <span id="datesOrdersBreadcrumbMonth">-</span> ‚Ä∫ <span id="datesOrdersBreadcrumbCustomer">-</span></div>
                        <h3>Orders Breakdown</h3>
                    </div>
                    <div>
                        <button class="back-btn" onclick="backToDatesCustomers()">‚Üê Back</button>
                        <button class="close-btn" onclick="closeAllDatesDrilldowns()">‚úï Close All</button>
                    </div>
                </div>
                <div class="summary-row" id="datesOrdersSummary"></div>
                <div class="scrollable-table">
                    <table class="data-table">
                        <thead><tr><th>Part</th><th>PO #</th><th>Status</th><th>Ship/Due Date</th><th>Qty</th><th>Unit Price</th><th>Profit/Part</th><th>P/L</th><th>Revenue</th></tr></thead>
                        <tbody id="datesOrdersDrilldownBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- BOM EXPLORER PAGE -->
        <div id="bom" class="page">
            <div class="page-header">
                <div><h2 data-i18n="bom.title">BOM Explorer</h2></div>
            </div>
            <div class="info-banner info active">
                <span class="icon">‚ÑπÔ∏è</span>
                <p><strong>Note:</strong> BOM data reflects current filter state in Google Sheets. If items appear missing, check that no filters are active in the source sheets.</p>
            </div>
            <div class="tabs">
                <div class="tab active" data-bomtab="final" onclick="switchBomTab('final')">Final Assembly</div>
                <div class="tab" data-bomtab="sub" onclick="switchBomTab('sub')">Sub Assembly</div>
                <div class="tab" data-bomtab="individual" onclick="switchBomTab('individual')">Individual Items</div>
            </div>
            <div class="chart-container">
                <div class="chart-header">
                    <h3>Select a Part</h3>
                    <input type="text" class="search-box" id="bomSearch" placeholder="Search parts..." oninput="filterBomSelector()">
                </div>
                <div class="bom-grid">
                    <div class="bom-selector" id="bomSelector"><p style="color:var(--text-secondary);">Loading...</p></div>
                    <div class="bom-details">
                        <div class="bom-header">
                            <h3 id="bomPartName">Select a part</h3>
                            <div class="category" id="bomCategory"></div>
                        </div>
                        <div id="bomContent"><p style="color:var(--text-secondary);">Click on a part from the list to view details.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // INTERNATIONALIZATION
        // ============================================================
        const translations = {
            en: {
                'logoSubtitle': 'Operations Dashboard',
                'nav.main': 'Main Dashboard',
                'nav.production': 'PRODUCTION',
                'nav.ordersData': 'Orders Data',
                'nav.ordersQueue': 'Need to Make',
                'nav.ordersStaged': 'Ready to Ship',
                'nav.ordersShipped': 'Shipped',
                'nav.inventory': 'Inventory',
                'nav.salesFinance': 'SALES & FINANCE',
                'nav.plOverview': 'P/L Overview',
                'nav.byPart': 'By Part Number',
                'nav.byCustomer': 'By Customer',
                'nav.byDate': 'By Date',
                'nav.billOfMaterials': 'BILL OF MATERIALS',
                'nav.bomExplorer': 'BOM Explorer',
                'loading': 'Loading data from Google Sheets...',
                'main.title': 'Operations Dashboard',
                'main.subtitle': 'Real-time overview of Roll Tech manufacturing operations',
                'stats.needToMake': 'Need to Make',
                'stats.making': 'Making',
                'stats.readyToShip': 'Ready to Ship',
                'stats.urgent': 'Urgent',
                'stats.totalUnits': 'Total Units',
                'stats.monthRevenue': 'Month Revenue',
                'stats.monthPL': 'Month P/L',
                'stats.missingParts': 'Missing Parts',
                'status.needToMake': 'Need to Make',
                'status.making': 'Making',
                'status.readyToShip': 'Ready to Ship',
                'status.shipped': 'Shipped',
                'status.urgent': 'URGENT',
                'dept.production': 'Production Planning',
                'dept.productionDesc': 'View orders to make, component status, and production queue',
                'dept.needToMake': 'Need to Make',
                'dept.units': 'Units',
                'dept.sales': 'Sales & P/L Analytics',
                'dept.salesDesc': 'Revenue, profitability, and customer analysis',
                'dept.revenue': 'Revenue',
                'dept.profit': 'Profit',
                'dept.orders': 'Orders',
                'dept.inventory': 'Inventory Management',
                'dept.inventoryDesc': 'Stock levels, reorder points, and material tracking',
                'chart.ordersByStatus': 'Orders by Status',
                'chart.upcomingDeadlines': 'Upcoming Deadlines (Next 14 Days)',
                'ordersData.title': 'All Orders Data',
                'ordersData.subtitle': 'Complete order database with all statuses',
                'ordersQueue.title': 'Orders Queue - Need to Make',
                'ordersQueue.subtitle': 'Orders pending production (Pending + Approved status)',
                'ordersStaged.title': 'Staged Orders - Ready to Ship',
                'ordersShipped.title': 'Shipped Orders History',
                'prod.missingMsg': 'orders have missing components.',
                'btn.backToDashboard': 'Back',
                'col.line': 'Line',
                'col.priority': 'Priority',
                'col.daysUntil': 'Days Until',
                'col.requestDate': 'Request Date',
                'col.customer': 'Customer',
                'col.ifNum': 'IF #',
                'col.part': 'Part #',
                'col.qty': 'Qty',
                'col.packaging': 'Packaging',
                'col.tire': 'Tire',
                'col.hub': 'Hub',
                'col.hubMold': 'Hub Mold',
                'col.bearings': 'Bearings',
                'col.status': 'Status',
                'col.assigned': 'Assigned To',
                'col.shippedDate': 'Shipped Date',
                'col.revenue': 'Revenue',
                'col.pl': 'P/L',
                'missing': 'Missing',
                'sales.title': 'P/L Overview',
                'inv.title': 'Inventory Management',
                'bom.title': 'BOM Explorer'
            },
            es: {
                'logoSubtitle': 'Panel de Operaciones',
                'nav.main': 'Panel Principal',
                'nav.production': 'PRODUCCI√ìN',
                'nav.ordersData': 'Datos de √ìrdenes',
                'nav.ordersQueue': 'Por Fabricar',
                'nav.ordersStaged': 'Listo para Enviar',
                'nav.ordersShipped': 'Enviados',
                'nav.inventory': 'Inventario',
                'nav.salesFinance': 'VENTAS Y FINANZAS',
                'nav.plOverview': 'Resumen P/L',
                'nav.byPart': 'Por N√∫mero de Parte',
                'nav.byCustomer': 'Por Cliente',
                'nav.byDate': 'Por Fecha',
                'nav.billOfMaterials': 'LISTA DE MATERIALES',
                'nav.bomExplorer': 'Explorador BOM',
                'loading': 'Cargando datos de Google Sheets...',
                'main.title': 'Panel de Operaciones',
                'main.subtitle': 'Vista en tiempo real de las operaciones de manufactura',
                'stats.needToMake': 'Por Fabricar',
                'stats.making': 'Fabricando',
                'stats.readyToShip': 'Listo para Enviar',
                'stats.urgent': 'Urgente',
                'stats.totalUnits': 'Unidades Totales',
                'stats.monthRevenue': 'Ingresos del Mes',
                'stats.monthPL': 'P/L del Mes',
                'stats.missingParts': 'Partes Faltantes',
                'status.needToMake': 'Por Fabricar',
                'status.making': 'Fabricando',
                'status.readyToShip': 'Listo para Enviar',
                'status.shipped': 'Enviado',
                'status.urgent': 'URGENTE',
                'dept.production': 'Planificaci√≥n de Producci√≥n',
                'dept.productionDesc': 'Ver √≥rdenes a fabricar y estado de componentes',
                'dept.needToMake': 'Por Fabricar',
                'dept.units': 'Unidades',
                'dept.sales': 'Ventas y An√°lisis P/L',
                'dept.salesDesc': 'Ingresos, rentabilidad y an√°lisis de clientes',
                'dept.revenue': 'Ingresos',
                'dept.profit': 'Ganancia',
                'dept.orders': 'Pedidos',
                'dept.inventory': 'Gesti√≥n de Inventario',
                'dept.inventoryDesc': 'Niveles de stock y seguimiento de materiales',
                'chart.ordersByStatus': '√ìrdenes por Estado',
                'chart.upcomingDeadlines': 'Pr√≥ximos Vencimientos (14 D√≠as)',
                'ordersData.title': 'Todos los Datos de √ìrdenes',
                'ordersData.subtitle': 'Base de datos completa de √≥rdenes',
                'ordersQueue.title': 'Cola de √ìrdenes - Por Fabricar',
                'ordersQueue.subtitle': '√ìrdenes pendientes de producci√≥n',
                'ordersStaged.title': '√ìrdenes en Staging - Listas para Enviar',
                'ordersShipped.title': 'Historial de √ìrdenes Enviadas',
                'prod.missingMsg': '√≥rdenes tienen componentes faltantes.',
                'btn.backToDashboard': 'Volver',
                'col.line': 'L√≠nea',
                'col.priority': 'Prioridad',
                'col.daysUntil': 'D√≠as Restantes',
                'col.requestDate': 'Fecha de Solicitud',
                'col.customer': 'Cliente',
                'col.ifNum': 'IF #',
                'col.part': 'Parte #',
                'col.qty': 'Cant',
                'col.packaging': 'Empaque',
                'col.tire': 'Llanta',
                'col.hub': 'Hub',
                'col.hubMold': 'Molde del Hub',
                'col.bearings': 'Baleros',
                'col.status': 'Estado',
                'col.assigned': 'Asignado a',
                'col.shippedDate': 'Fecha de Env√≠o',
                'col.revenue': 'Ingresos',
                'col.pl': 'P/L',
                'missing': 'Faltante',
                'sales.title': 'Resumen P/L',
                'inv.title': 'Gesti√≥n de Inventario',
                'bom.title': 'Explorador BOM'
            }
        };
        
        let currentLang = 'en';
        
        function setLanguage(lang) {
            currentLang = lang;
            document.getElementById('langEN').classList.toggle('active', lang === 'en');
            document.getElementById('langES').classList.toggle('active', lang === 'es');
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) el.textContent = translations[lang][key];
            });
            document.getElementById('logoSubtitle').textContent = translations[lang]['logoSubtitle'];
            if (currentPage.startsWith('orders-')) {
                if (currentPage === 'orders-data') updateOrdersDataPage();
                else if (currentPage === 'orders-queue') updateOrdersQueuePage();
                else if (currentPage === 'orders-staged') updateOrdersStagedPage();
                else if (currentPage === 'orders-shipped') updateOrdersShippedPage();
            } else if (currentPage === 'inventory') updateInventoryPage();
            else if (currentPage === 'main') updateMainDashboard();
        }
        
        function t(key) { return translations[currentLang][key] || key; }

        // ============================================================
        // CONFIGURATION
        // ============================================================
        const SHEET_ID = '1bK0Ne-vX3i5wGoqyAklnyFDUNdE-WaN4Xs5XjggBSXw';
        const MAIN_DATA_GID = '290032634';
        const FUSION_EXPORT_GID = '1805754553';
        const PROD_DATA_TOTALS_GID = '148810546';
        const CONFIG_GID = '912029812';
        
        const COL = {
            CATEGORY: 'Category',
            REQUEST_DATE: 'Date of Request',
            PRIORITY: 'Priority Level',
            URGENT: 'Urgent Override',
            LINE: 'Line',
            CUSTOMER: 'Customer',
            IF_NUM: 'IF #',
            PO_NUM: 'Customer PO',
            PART: 'Part #',
            QTY: 'Order Qty',
            PACKAGING: 'Packaging (tipo de empaquetado)',
            TIRE: 'Tire',
            HUB: 'Hub',
            HUB_MOLD: 'Hub Mold',
            BEARINGS: 'Bearings',
            ASSIGNED: 'Assigned to',
            STATUS: 'Work order Internal Status',
            DAYS_UNTIL: 'Days until promise date',
            SHIPPED_DATE: 'Shipped Date',
            REQUESTED_DATE: 'Requested Completion Date',
            UNIT_PRICE: 'Unit Price',
            REVENUE: 'Revenue',
            PL: 'P/L',
            PL_TOTAL: 'P/L total',
            VARIABLE_COST: 'Variable Cost',
            TOTAL_COST: 'Total Cost'
        };
        
        const COL_ALTS = {
            CATEGORY: ['Category', 'Categoria'],
            REQUEST_DATE: ['Date of Request', 'Fecha de Entrega', 'Requested Completion Date'],
            PRIORITY: ['Priority Level', 'Prioridad', 'Priority'],
            LINE: ['Line', 'Linea'],
            CUSTOMER: ['Customer', 'Cliente'],
            PART: ['Part #', 'Numero de parte', 'RT Part #', 'Part Number'],
            QTY: ['Order Qty', 'Cantidad de la orden', 'Qty', 'Quantity'],
            PACKAGING: ['Packaging (tipo de empaquetado)', 'tipo de empaquetado', 'Packaging'],
            TIRE: ['Tire', 'Tire (Llanta)', 'Llanta'],
            HUB: ['Hub', 'Centro', 'Cubo'],
            HUB_MOLD: ['Hub Mold', 'Hub Mold (Molde del Hub)', 'Molde del Hub'],
            BEARINGS: ['Bearings', 'Bearings (Balero)', 'Balero', 'Baleros'],
            ASSIGNED: ['Assigned to', 'Assigned to: (Asignado a:)', 'Asignado a'],
            STATUS: ['Work order Internal Status', 'Work order Status', 'Status', 'Estado'],
            DAYS_UNTIL: ['Days until promise date', 'Dias faltantes', 'Days until', 'Days remaining'],
            IF_NUM: ['IF #', 'IF#', 'IF Number'],
            PO_NUM: ['Customer PO', 'PO#', 'PO Number', 'Customer PO#'],
            PL: ['P/L', 'P/L total', 'PL', 'Profit/Loss'],
            REVENUE: ['Revenue', 'Total Sell Price', 'Sales'],
            UNIT_PRICE: ['Unit Price', 'Price', 'Sell Price']
        };
        
        function getVal(row, key) {
            const normalize = s => s.toLowerCase().replace(/[\r\n]+/g, ' ').replace(/\s+/g, ' ').trim();
            if (row[COL[key]] !== undefined && row[COL[key]] !== null) return row[COL[key]];
            const alts = COL_ALTS[key];
            if (alts) {
                for (const alt of alts) {
                    if (row[alt] !== undefined && row[alt] !== null) return row[alt];
                }
            }
            const targetNames = alts ? [COL[key], ...alts] : [COL[key]];
            for (const target of targetNames) {
                if (!target) continue;
                const targetNorm = normalize(target);
                for (const k of Object.keys(row)) {
                    if (normalize(k) === targetNorm) return row[k];
                }
            }
            return null;
        }
        
        // ============================================================
        // STATE VARIABLES
        // ============================================================
        let allData = [];
        let inventoryData = [];
        let bomFinalData = [], bomSubData = [], bomIndividualData = [];
        let currentBomTab = 'final';
        let config = {};
        let charts = {};
        let currentPage = 'main';
        
        // Filter states for each page
        let ordersDataFilters = { categories: { rolltech: true, molding: false }, statuses: { pending: true, wip: true, staged: true, shipped: false } };
        let ordersQueueFilters = { categories: { rolltech: true, molding: false } };
        let ordersStagedFilters = { categories: { rolltech: true, molding: false } };
        let ordersShippedFilters = { categories: { rolltech: true, molding: false }, fromDate: null, toDate: null };
        let salesFilters = { categories: { rolltech: true, molding: false }, fromDate: null, toDate: null };
        let partsFilters = { categories: { rolltech: true, molding: false }, fromDate: null, toDate: null, watchlistOnly: false };
        let customersFilters = { categories: { rolltech: true, molding: false }, fromDate: null, toDate: null, watchlistOnly: false };
        let datesFilters = { categories: { rolltech: true, molding: false }, fromDate: null, toDate: null };
        
        // Sort states
        let ordersDataSort = { field: 'daysUntil', asc: true };
        let ordersQueueSort = { field: 'daysUntil', asc: true };
        let ordersStagedSort = { field: 'customer', asc: true };
        let ordersShippedSort = { field: 'shippedDate', asc: false };
        let partsSort = { field: 'pl', asc: false };
        let customersSort = { field: 'pl', asc: false };
        let invFilter = 'all';
        let invSort = { field: 'partNumber', asc: true };
        
        // Drilldown state
        let currentDrilldownPart = null;
        let currentDrilldownCustomer = null;
        let currentDrilldownMonth = null;
        
        // Watchlist (localStorage)
        let watchlistParts = JSON.parse(localStorage.getItem('rolltech_watchlist_parts') || '[]');
        let watchlistCustomers = JSON.parse(localStorage.getItem('rolltech_watchlist_customers') || '[]');

        // ============================================================
        // UTILITIES
        // ============================================================
        const formatCurrency = v => v == null || isNaN(v) ? '$0.00' : new Intl.NumberFormat('en-US', {style:'currency',currency:'USD'}).format(v);
        const formatNumber = v => v == null || isNaN(v) ? '0' : new Intl.NumberFormat('en-US').format(Math.round(v));
        const parseNumber = v => { if (!v || v === '') return 0; if (typeof v === 'number') return v; let c = String(v).replace(/[$,%\s]/g,''); if (c.startsWith('(') && c.endsWith(')')) c = '-' + c.slice(1,-1); return parseFloat(c) || 0; };
        const parseDate = d => { if (!d) return null; if (d.includes('/')) { const p = d.split('/'); if (p.length >= 3) return new Date(p[2].length===2?'20'+p[2]:p[2], p[0]-1, p[1]); } return new Date(d); };
        const isEmpty = v => v === null || v === undefined || v === '';
        const isMissingComponent = v => v === null || v === undefined || v === '' || v === '-';
        const hasMissingCostData = row => isEmpty(row[COL.VARIABLE_COST]) || isEmpty(row[COL.TOTAL_COST]) || (isEmpty(row[COL.PL]) && isEmpty(row[COL.PL_TOTAL]));
        const getPLValue = row => { if (!isEmpty(row[COL.PL])) return parseNumber(row[COL.PL]); if (!isEmpty(row[COL.PL_TOTAL])) return parseNumber(row[COL.PL_TOTAL]); return 0; };
        
        // Date attribution helpers (NEW in v5)
        function getAttributionDate(row) {
            const status = getStatus(row);
            if (status === 'shipped') return row[COL.SHIPPED_DATE];
            return row[COL.REQUESTED_DATE] || getVal(row, 'REQUEST_DATE');
        }
        
        function getMonthKey(dateStr) {
            if (!dateStr) return null;
            if (dateStr.includes('/')) {
                const parts = dateStr.split('/');
                return `${parts[2].length === 2 ? '20' + parts[2] : parts[2]}-${parts[0].padStart(2, '0')}`;
            }
            return dateStr.substring(0, 7);
        }
        
        function formatMonthLabel(monthKey) {
            if (!monthKey) return '-';
            const [year, month] = monthKey.split('-');
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${months[parseInt(month) - 1]} ${year}`;
        }
        
        function getUnitPrice(row) {
            const unitPrice = parseNumber(row[COL.UNIT_PRICE]);
            if (unitPrice > 0) return unitPrice;
            const revenue = parseNumber(row[COL.REVENUE]);
            const qty = parseNumber(getVal(row, 'QTY'));
            return qty > 0 ? revenue / qty : 0;
        }
        
        function getProfitPerPart(row) {
            const pl = getPLValue(row);
            const qty = parseNumber(getVal(row, 'QTY'));
            return qty > 0 ? pl / qty : 0;
        }
        
        function getContributionBadge(margin) {
            if (margin < -10) return '<span class="badge" style="background:var(--danger);">CRITICAL</span>';
            if (margin < 0) return '<span class="badge" style="background:var(--warning);color:#1a202c;">LOW</span>';
            if (margin < 15) return '<span class="badge" style="background:var(--accent);">TARGET</span>';
            return '<span class="badge" style="background:var(--success);">PROFITABLE</span>';
        }
        
        // Watchlist functions
        function toggleWatchlistPart(part) {
            const idx = watchlistParts.indexOf(part);
            if (idx > -1) watchlistParts.splice(idx, 1);
            else watchlistParts.push(part);
            localStorage.setItem('rolltech_watchlist_parts', JSON.stringify(watchlistParts));
            updateSalesPartsPage();
        }
        
        function toggleWatchlistCustomer(customer) {
            const idx = watchlistCustomers.indexOf(customer);
            if (idx > -1) watchlistCustomers.splice(idx, 1);
            else watchlistCustomers.push(customer);
            localStorage.setItem('rolltech_watchlist_customers', JSON.stringify(watchlistCustomers));
            updateSalesCustomersPage();
        }
        
        function isInWatchlist(type, value) {
            if (type === 'part') return watchlistParts.includes(value);
            if (type === 'customer') return watchlistCustomers.includes(value);
            return false;
        }
        
        const getCategory = row => {
            const cat = (getVal(row, 'CATEGORY') || '').toLowerCase();
            if (cat.includes('roll tech')) return 'rolltech';
            if (cat.includes('molding')) return 'molding';
            return 'other';
        };
        
        const getStatus = row => {
            const status = (getVal(row, 'STATUS') || '').toLowerCase();
            if (status.includes('pending') || status.includes('approved')) return 'pending';
            if (status.includes('staged')) return 'staged';
            if (status.includes('work in progress') || status.includes('wip')) return 'wip';
            if (status.includes('shipped')) return 'shipped';
            return status;
        };
        
        const getStatusBadge = status => {
            const s = (status || '').toLowerCase();
            if (s.includes('shipped') || s === 'shipped') return `<span class="badge shipped">${t('status.shipped')}</span>`;
            if (s.includes('pending') || s.includes('approved') || s === 'pending') return `<span class="badge pending">${t('status.needToMake')}</span>`;
            if (s.includes('staged') || s === 'staged') return `<span class="badge staged">${t('status.readyToShip')}</span>`;
            if (s.includes('work in progress') || s.includes('wip') || s === 'wip') return `<span class="badge wip">${t('status.making')}</span>`;
            return `<span class="badge">${status || '-'}</span>`;
        };
        
        const getPriorityBadge = (priority, urgent) => {
            const p = parseNumber(priority);
            const isUrgent = (urgent || '').toLowerCase() === 'urgent';
            if (isUrgent) return `<span class="badge urgent">${t('status.urgent')}</span>`;
            if (p === 1) return '<span class="badge priority-1">P1</span>';
            if (p === 2) return '<span class="badge priority-2">P2</span>';
            if (p === 3) return '<span class="badge priority-3">P3</span>';
            if (p === 4) return '<span class="badge priority-4">P4</span>';
            return `<span class="badge">P${p || '-'}</span>`;
        };
        
        const formatComponent = (value) => {
            if (isMissingComponent(value)) return `<span class="cell-missing">${t('missing')}</span>`;
            if (value === 'NA' || value === 'N/A') return `<span style="color:var(--text-secondary);">NA</span>`;
            return `<span class="cell-available">${value}</span>`;
        };

        // ============================================================
        // DATA LOADING
        // ============================================================
        async function fetchSheetData(gid) {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${gid}`;
            const res = await fetch(url);
            const text = await res.text();
            const json = JSON.parse(text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1));
            const headers = json.table.cols.map(c => (c.label || '').replace(/[\r\n]+/g, ' ').replace(/\s+/g, ' ').trim());
            return json.table.rows.map(r => {
                const obj = {};
                headers.forEach((h, i) => { if (h && r.c && r.c[i]) obj[h] = r.c[i].f || r.c[i].v; });
                return obj;
            });
        }
        
        async function loadDashboard() {
            try {
                const raw = await fetchSheetData(MAIN_DATA_GID);
                allData = raw.filter(r => {
                    const cat = getCategory(r);
                    return (cat === 'rolltech' || cat === 'molding') && getVal(r, 'PART');
                });
                if (allData.length === 0) allData = raw.filter(r => getVal(r, 'PART'));
                
                loadInventoryData().catch(e => console.warn('Inventory load failed:', e));
                loadBOMData().catch(e => console.warn('BOM load failed:', e));
                
                const now = new Date();
                document.getElementById('lastUpdated').textContent = `Updated: ${now.toLocaleTimeString()}`;
                document.getElementById('dataInfo').innerHTML = `<strong>Data Loaded</strong>${allData.length} orders<br>${now.toLocaleTimeString()}`;
                
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('main').classList.add('active');
                updateMainDashboard();
            } catch (e) {
                console.error('Load error:', e);
                document.getElementById('loadingState').innerHTML = `<h3 style="color:var(--danger);">‚ö†Ô∏è Error</h3><p>${e.message}</p><button onclick="location.reload()" style="padding:10px 20px;background:var(--accent);color:white;border:none;border-radius:8px;cursor:pointer;margin-top:12px;">Retry</button>`;
            }
        }
        
        async function loadInventoryData() {
            try {
                const fusionData = await fetchSheetData(FUSION_EXPORT_GID);
                const prodTotalsData = await fetchSheetData(PROD_DATA_TOTALS_GID);
                const prodTotalsMap = {};
                prodTotalsData.forEach(row => {
                    let partNum = (row['Part Number'] || '').toString().trim().replace(/[^\x20-\x7E]/g, '');
                    if (partNum) {
                        prodTotalsMap[partNum] = {
                            product: row['Product'] || '',
                            qtyNeeded: parseNumber(row['Quantity Needed']),
                            minimums: parseNumber(row['Minimums']),
                            manualTarget: parseNumber(row['Manual target']),
                            moldType: row['Mold type'] || '',
                            fusionInventory: parseNumber(row['Fusion Inventory']),
                            partsToBeMade: parseNumber(row['Parts to be made'])
                        };
                    }
                });
                const mergedData = [];
                const seenParts = new Set();
                fusionData.forEach(row => {
                    let partNum = (row['itemNumber'] || '').toString().trim().replace(/[^\x20-\x7E]/g, '');
                    if (!partNum) return;
                    seenParts.add(partNum);
                    const prodData = prodTotalsMap[partNum] || {};
                    const fusionTarget = parseNumber(row['Target']);
                    mergedData.push({
                        partNumber: partNum,
                        product: prodData.product || '',
                        fusionQty: parseNumber(row['Real number value']),
                        minimum: prodData.minimums || fusionTarget || 0,
                        manualTarget: prodData.manualTarget || 0,
                        qtyNeeded: prodData.qtyNeeded || 0,
                        partsToBeMade: prodData.partsToBeMade || 0,
                        moldType: prodData.moldType || ''
                    });
                });
                prodTotalsData.forEach(row => {
                    let partNum = (row['Part Number'] || '').toString().trim().replace(/[^\x20-\x7E]/g, '');
                    if (partNum && !seenParts.has(partNum)) {
                        const data = prodTotalsMap[partNum];
                        mergedData.push({
                            partNumber: partNum,
                            product: data.product || '',
                            fusionQty: data.fusionInventory || 0,
                            minimum: data.minimums || 0,
                            manualTarget: data.manualTarget || 0,
                            qtyNeeded: data.qtyNeeded || 0,
                            partsToBeMade: data.partsToBeMade || 0,
                            moldType: data.moldType || ''
                        });
                    }
                });
                inventoryData = mergedData;
            } catch (e) { console.error('Inventory load error:', e); inventoryData = []; }
        }
        
        async function loadBOMData() {
            try {
                const configData = await fetchSheetData(CONFIG_GID);
                config = {};
                configData.forEach(row => {
                    if (row['Dashboard Name'] === 'P&L Dashboard' && row['GID Number']) {
                        config[row['Tab Name']] = { gid: row['GID Number'] };
                    }
                });
                if (config['BOM individual items Reference data']) bomIndividualData = await fetchSheetData(config['BOM individual items Reference data'].gid);
                if (config['BOM Sub assembly Reference data']) bomSubData = await fetchSheetData(config['BOM Sub assembly Reference data'].gid);
                if (config['BOM Final assembly Reference data']) bomFinalData = await fetchSheetData(config['BOM Final assembly Reference data'].gid);
            } catch (e) { console.warn('BOM load error:', e); }
        }

        // ============================================================
        // NAVIGATION
        // ============================================================
        function navigateTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            document.querySelector(`.nav-item[data-page="${page}"]`)?.classList.add('active');
            currentPage = page;
            
            // Close all drilldowns when navigating
            closeAllPartsDrilldowns();
            closeAllCustomersDrilldowns();
            closeAllDatesDrilldowns();
            
            switch(page) {
                case 'main': updateMainDashboard(); break;
                case 'orders-data': updateOrdersDataPage(); break;
                case 'orders-queue': updateOrdersQueuePage(); break;
                case 'orders-staged': updateOrdersStagedPage(); break;
                case 'orders-shipped': updateOrdersShippedPage(); break;
                case 'inventory': updateInventoryPage(); break;
                case 'sales-overview': updateSalesOverview(); break;
                case 'sales-parts': updateSalesPartsPage(); break;
                case 'sales-customers': updateSalesCustomersPage(); break;
                case 'sales-dates': updateSalesDatesPage(); break;
                case 'bom': initBomExplorer(); break;
            }
            document.querySelector('.sidebar').classList.remove('open');
            document.querySelector('.sidebar-overlay').classList.remove('active');
        }
        
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('open');
            document.querySelector('.sidebar-overlay').classList.toggle('active');
        }

        // ============================================================
        // MAIN DASHBOARD
        // ============================================================
        function updateMainDashboard() {
            const rollTechData = allData.filter(r => getCategory(r) === 'rolltech');
            const needToMakeOrders = rollTechData.filter(r => getStatus(r) === 'pending');
            const urgentOrders = needToMakeOrders.filter(r => (getVal(r, 'URGENT') || '').toLowerCase() === 'urgent');
            const totalQty = needToMakeOrders.reduce((s, r) => s + parseNumber(getVal(r, 'QTY')), 0);
            
            const now = new Date();
            const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            const monthData = rollTechData.filter(r => {
                const d = r[COL.SHIPPED_DATE] || r[COL.REQUESTED_DATE];
                if (!d) return false;
                let month;
                if (d.includes('/')) { const parts = d.split('/'); month = `${parts[2].length === 2 ? '20' + parts[2] : parts[2]}-${parts[0].padStart(2, '0')}`; }
                else { month = d.substring(0, 7); }
                return month === currentMonth;
            });
            const monthRevenue = monthData.reduce((s, r) => s + parseNumber(r[COL.REVENUE]), 0);
            const monthPL = monthData.filter(r => !hasMissingCostData(r)).reduce((s, r) => s + getPLValue(r), 0);
            
            const missingComponents = needToMakeOrders.filter(r => {
                return isMissingComponent(getVal(r, 'TIRE')) || isMissingComponent(getVal(r, 'HUB')) || isMissingComponent(getVal(r, 'BEARINGS'));
            }).length;
            
            document.getElementById('qsNeedToMake').textContent = formatNumber(needToMakeOrders.length);
            document.getElementById('qsUrgentOrders').textContent = formatNumber(urgentOrders.length);
            document.getElementById('qsUrgentOrders').className = `value ${urgentOrders.length > 0 ? 'negative' : ''}`;
            document.getElementById('qsTotalQty').textContent = formatNumber(totalQty);
            document.getElementById('qsMonthlyRevenue').textContent = formatCurrency(monthRevenue);
            document.getElementById('qsMonthlyPL').textContent = formatCurrency(monthPL);
            document.getElementById('qsMonthlyPL').className = `value ${monthPL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('qsMissingComponents').textContent = formatNumber(missingComponents);
            
            document.getElementById('deptProdOrders').textContent = formatNumber(needToMakeOrders.length);
            document.getElementById('deptProdUnits').textContent = formatNumber(totalQty);
            document.getElementById('deptProdUrgent').textContent = formatNumber(urgentOrders.length);
            
            const salesTotal = rollTechData.reduce((s, r) => s + parseNumber(r[COL.REVENUE]), 0);
            const salesPL = rollTechData.filter(r => !hasMissingCostData(r)).reduce((s, r) => s + getPLValue(r), 0);
            document.getElementById('deptSalesRev').textContent = formatCurrency(salesTotal);
            document.getElementById('deptSalesPL').textContent = formatCurrency(salesPL);
            document.getElementById('deptSalesPL').className = `value ${salesPL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('deptSalesOrders').textContent = formatNumber(rollTechData.length);
            
            renderMainStatusChart(rollTechData.filter(r => getStatus(r) !== 'shipped'));
            renderMainDeadlineChart(needToMakeOrders);
        }
        
        function renderMainStatusChart(data) {
            const statusCounts = { pending: 0, wip: 0, staged: 0 };
            data.forEach(r => { const s = getStatus(r); if (statusCounts[s] !== undefined) statusCounts[s]++; });
            const labels = [t('status.needToMake'), t('status.making'), t('status.readyToShip')];
            const values = [statusCounts.pending, statusCounts.wip, statusCounts.staged];
            const colors = ['#d69e2e', '#319795', '#4299e1'];
            if (charts.mainStatus) charts.mainStatus.destroy();
            charts.mainStatus = new Chart(document.getElementById('mainStatusChart'), {
                type: 'doughnut',
                data: { labels, datasets: [{ data: values, backgroundColor: colors }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#a0aec0', font: { size: 11 } } } } }
            });
        }
        
        function renderMainDeadlineChart(data) {
            const deadlines = {};
            for (let i = -7; i <= 14; i++) deadlines[i] = 0;
            data.forEach(r => { const days = parseNumber(getVal(r, 'DAYS_UNTIL')); if (days >= -7 && days <= 14) deadlines[days]++; });
            const labels = Object.keys(deadlines).map(d => { const n = parseInt(d); if (n < 0) return `${Math.abs(n)}d late`; if (n === 0) return 'Today'; return `${n}d`; });
            const values = Object.values(deadlines);
            const colors = Object.keys(deadlines).map(d => { const n = parseInt(d); if (n < 0) return 'rgba(229,62,62,0.8)'; if (n <= 2) return 'rgba(214,158,46,0.8)'; return 'rgba(49,130,206,0.8)'; });
            if (charts.mainDeadline) charts.mainDeadline.destroy();
            charts.mainDeadline = new Chart(document.getElementById('mainDeadlineChart'), {
                type: 'bar',
                data: { labels, datasets: [{ data: values, backgroundColor: colors }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { color: '#a0aec0' }, grid: { color: 'rgba(255,255,255,0.05)' } }, x: { ticks: { color: '#a0aec0', font: { size: 9 } }, grid: { display: false } } } }
            });
        }

        // ============================================================
        // Download CSV Utility
        // ============================================================
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        }

        // Placeholder functions for pages (to be implemented)
        function updateOrdersDataPage() { console.log('Orders Data page loaded - ' + allData.length + ' orders'); renderOrdersDataTable(); }
        function updateOrdersQueuePage() { console.log('Orders Queue page loaded'); }
        function updateOrdersStagedPage() { console.log('Orders Staged page loaded'); }
        function updateOrdersShippedPage() { console.log('Orders Shipped page loaded'); }
        function updateInventoryPage() { console.log('Inventory page loaded'); }
        function updateSalesOverview() { console.log('Sales Overview page loaded'); renderSalesOverviewData(); }
        function updateSalesPartsPage() { console.log('Sales Parts page loaded'); renderSalesPartsData(); }
        function updateSalesCustomersPage() { console.log('Sales Customers page loaded'); renderSalesCustomersData(); }
        function updateSalesDatesPage() { console.log('Sales Dates page loaded'); renderSalesDatesData(); }
        function initBomExplorer() { console.log('BOM Explorer page loaded'); }

        // Toggle functions
        function toggleOrdersDataCategory(cat) { ordersDataFilters.categories[cat] = !ordersDataFilters.categories[cat]; updateOrdersDataPage(); }
        function toggleOrdersDataStatus(status) { ordersDataFilters.statuses[status] = !ordersDataFilters.statuses[status]; updateOrdersDataPage(); }
        function toggleOrdersQueueCategory(cat) { ordersQueueFilters.categories[cat] = !ordersQueueFilters.categories[cat]; updateOrdersQueuePage(); }
        function toggleOrdersStagedCategory(cat) { ordersStagedFilters.categories[cat] = !ordersStagedFilters.categories[cat]; updateOrdersStagedPage(); }
        function toggleOrdersShippedCategory(cat) { ordersShippedFilters.categories[cat] = !ordersShippedFilters.categories[cat]; updateOrdersShippedPage(); }
        function toggleSalesCategory(cat) { salesFilters.categories[cat] = !salesFilters.categories[cat]; updateSalesOverview(); }
        function togglePartsCategory(cat) { partsFilters.categories[cat] = !partsFilters.categories[cat]; updateSalesPartsPage(); }
        function toggleCustomersCategory(cat) { customersFilters.categories[cat] = !customersFilters.categories[cat]; updateSalesCustomersPage(); }
        function toggleDatesCategory(cat) { datesFilters.categories[cat] = !datesFilters.categories[cat]; updateSalesDatesPage(); }

        // Date filter functions
        function applyShippedDateFilter() { updateOrdersShippedPage(); }
        function resetShippedDateFilter() { document.getElementById('ordersShippedFromDate').value = ''; document.getElementById('ordersShippedToDate').value = ''; updateOrdersShippedPage(); }
        function applyPartsDateFilter() { partsFilters.fromDate = document.getElementById('partsFromDate').value ? new Date(document.getElementById('partsFromDate').value) : null; partsFilters.toDate = document.getElementById('partsToDate').value ? new Date(document.getElementById('partsToDate').value) : null; updateSalesPartsPage(); }
        function resetPartsDateFilter() { document.getElementById('partsFromDate').value = ''; document.getElementById('partsToDate').value = ''; partsFilters.fromDate = null; partsFilters.toDate = null; updateSalesPartsPage(); }
        function applyCustomersDateFilter() { customersFilters.fromDate = document.getElementById('customersFromDate').value ? new Date(document.getElementById('customersFromDate').value) : null; customersFilters.toDate = document.getElementById('customersToDate').value ? new Date(document.getElementById('customersToDate').value) : null; updateSalesCustomersPage(); }
        function resetCustomersDateFilter() { document.getElementById('customersFromDate').value = ''; document.getElementById('customersToDate').value = ''; customersFilters.fromDate = null; customersFilters.toDate = null; updateSalesCustomersPage(); }
        function applyDatesDateFilter() { datesFilters.fromDate = document.getElementById('datesFromDate').value ? new Date(document.getElementById('datesFromDate').value) : null; datesFilters.toDate = document.getElementById('datesToDate').value ? new Date(document.getElementById('datesToDate').value) : null; updateSalesDatesPage(); }
        function resetDatesDateFilter() { document.getElementById('datesFromDate').value = ''; document.getElementById('datesToDate').value = ''; datesFilters.fromDate = null; datesFilters.toDate = null; updateSalesDatesPage(); }

        // Watchlist filter toggles
        function togglePartsWatchlistFilter() { partsFilters.watchlistOnly = !partsFilters.watchlistOnly; document.getElementById('partsWatchlistBtn').classList.toggle('active', partsFilters.watchlistOnly); updateSalesPartsPage(); }
        function toggleCustomersWatchlistFilter() { customersFilters.watchlistOnly = !customersFilters.watchlistOnly; document.getElementById('customersWatchlistBtn').classList.toggle('active', customersFilters.watchlistOnly); updateSalesCustomersPage(); }

        // Filter table functions
        function filterOrdersDataTable() { updateOrdersDataPage(); }
        function filterOrdersQueueTable() { updateOrdersQueuePage(); }
        function filterOrdersStagedTable() { updateOrdersStagedPage(); }
        function filterOrdersShippedTable() { updateOrdersShippedPage(); }
        function filterPartsTable() { updateSalesPartsPage(); }
        function filterCustomersTable() { updateSalesCustomersPage(); }
        function filterInvTable() { updateInventoryPage(); }

        // Export functions
        function exportOrdersDataToCSV() { downloadCSV('Orders Data Export', 'orders_data.csv'); }
        function exportOrdersQueueToCSV() { downloadCSV('Orders Queue Export', 'orders_queue.csv'); }
        function exportOrdersStagedToCSV() { downloadCSV('Orders Staged Export', 'orders_staged.csv'); }
        function exportOrdersShippedToCSV() { downloadCSV('Orders Shipped Export', 'orders_shipped.csv'); }
        function exportSalesCSV() { downloadCSV('Sales Export', 'sales.csv'); }
        function exportPartsCSV() { downloadCSV('Parts Export', 'parts.csv'); }
        function exportCustomersCSV() { downloadCSV('Customers Export', 'customers.csv'); }
        function exportDatesCSV() { downloadCSV('Dates Export', 'dates.csv'); }
        function exportInvCSV() { downloadCSV('Inventory Export', 'inventory.csv'); }

        // Sort functions
        function sortPartsTable(field) { if (partsSort.field === field) partsSort.asc = !partsSort.asc; else { partsSort.field = field; partsSort.asc = field === 'part'; } updateSalesPartsPage(); }
        function sortCustomersTable(field) { if (customersSort.field === field) customersSort.asc = !customersSort.asc; else { customersSort.field = field; customersSort.asc = field === 'customer'; } updateSalesCustomersPage(); }
        function sortInvTable(field) { if (invSort.field === field) invSort.asc = !invSort.asc; else { invSort.field = field; invSort.asc = true; } updateInventoryPage(); }
        function setInvFilter(f) { invFilter = f; updateInventoryPage(); }

        // Drilldown functions
        function showPartsCustomerDrilldown(part) { currentDrilldownPart = part; document.getElementById('partsCustomerDrilldown').classList.add('active'); document.getElementById('partsCustomerDrilldownPart').textContent = part; }
        function closePartsCustomerDrilldown() { document.getElementById('partsCustomerDrilldown').classList.remove('active'); document.getElementById('partsOrdersDrilldown').classList.remove('active'); currentDrilldownPart = null; }
        function showPartsOrdersDrilldown(part, customer) { currentDrilldownCustomer = customer; document.getElementById('partsOrdersDrilldown').classList.add('active'); }
        function closePartsOrdersDrilldown() { document.getElementById('partsOrdersDrilldown').classList.remove('active'); }
        function backToPartsCustomers() { document.getElementById('partsOrdersDrilldown').classList.remove('active'); }
        function closeAllPartsDrilldowns() { closePartsCustomerDrilldown(); }

        function showCustomersProductDrilldown(customer) { currentDrilldownCustomer = customer; document.getElementById('customersProductDrilldown').classList.add('active'); document.getElementById('customersProductDrilldownCustomer').textContent = customer; }
        function closeCustomersProductDrilldown() { document.getElementById('customersProductDrilldown').classList.remove('active'); document.getElementById('customersOrdersDrilldown').classList.remove('active'); currentDrilldownCustomer = null; }
        function showCustomersOrdersDrilldown(customer, part) { currentDrilldownPart = part; document.getElementById('customersOrdersDrilldown').classList.add('active'); }
        function closeCustomersOrdersDrilldown() { document.getElementById('customersOrdersDrilldown').classList.remove('active'); }
        function backToCustomersProducts() { document.getElementById('customersOrdersDrilldown').classList.remove('active'); }
        function closeAllCustomersDrilldowns() { closeCustomersProductDrilldown(); }

        function showDatesCustomerDrilldown(month) { currentDrilldownMonth = month; document.getElementById('datesCustomerDrilldown').classList.add('active'); document.getElementById('datesCustomerDrilldownMonth').textContent = formatMonthLabel(month); }
        function closeDatesCustomerDrilldown() { document.getElementById('datesCustomerDrilldown').classList.remove('active'); document.getElementById('datesOrdersDrilldown').classList.remove('active'); currentDrilldownMonth = null; }
        function showDatesOrdersDrilldown(month, customer) { currentDrilldownCustomer = customer; document.getElementById('datesOrdersDrilldown').classList.add('active'); }
        function closeDatesOrdersDrilldown() { document.getElementById('datesOrdersDrilldown').classList.remove('active'); }
        function backToDatesCustomers() { document.getElementById('datesOrdersDrilldown').classList.remove('active'); }
        function closeAllDatesDrilldowns() { closeDatesCustomerDrilldown(); }

        // BOM functions
        function switchBomTab(tab) { currentBomTab = tab; document.querySelectorAll('.tab[data-bomtab]').forEach(t => t.classList.toggle('active', t.dataset.bomtab === tab)); }
        function filterBomSelector() { }
        function showBomDetails(index) { }

        // ============================================================
        // RENDER FUNCTIONS (Basic implementations)
        // ============================================================
        function renderOrdersDataTable() {
            const data = allData.filter(r => {
                const cat = getCategory(r);
                const status = getStatus(r);
                if (!ordersDataFilters.categories[cat]) return false;
                if (!ordersDataFilters.statuses[status]) return false;
                return true;
            });
            
            document.getElementById('ordersDataTotalOrders').textContent = formatNumber(data.length);
            document.getElementById('ordersDataTotalUnits').textContent = `${formatNumber(data.reduce((s,r) => s + parseNumber(getVal(r,'QTY')), 0))} units`;
            document.getElementById('ordersDataNeedToMake').textContent = formatNumber(data.filter(r => getStatus(r) === 'pending').length);
            document.getElementById('ordersDataMaking').textContent = formatNumber(data.filter(r => getStatus(r) === 'wip').length);
            document.getElementById('ordersDataReadyToShip').textContent = formatNumber(data.filter(r => getStatus(r) === 'staged').length);
            document.getElementById('ordersDataLastUpdated').textContent = new Date().toLocaleTimeString();
            document.getElementById('ordersDataTableCount').textContent = `${data.length} orders`;
            
            document.getElementById('ordersDataTableHeader').innerHTML = '<th>Line</th><th>Priority</th><th>Days Until</th><th>Customer</th><th>Part #</th><th>Qty</th><th>Tire</th><th>Hub</th><th>Bearings</th><th>Status</th>';
            document.getElementById('ordersDataTableBody').innerHTML = data.slice(0, 100).map(r => `<tr>
                <td><strong>${getVal(r, 'LINE') || '-'}</strong></td>
                <td>${getPriorityBadge(getVal(r, 'PRIORITY'), getVal(r, 'URGENT'))}</td>
                <td>${getVal(r, 'DAYS_UNTIL') || '-'}</td>
                <td>${getVal(r, 'CUSTOMER') || '-'}</td>
                <td><strong>${getVal(r, 'PART') || '-'}</strong></td>
                <td>${formatNumber(parseNumber(getVal(r, 'QTY')))}</td>
                <td>${formatComponent(getVal(r, 'TIRE'))}</td>
                <td>${formatComponent(getVal(r, 'HUB'))}</td>
                <td>${formatComponent(getVal(r, 'BEARINGS'))}</td>
                <td>${getStatusBadge(getStatus(r))}</td>
            </tr>`).join('');
        }

        function renderSalesOverviewData() {
            const data = allData.filter(r => salesFilters.categories[getCategory(r)]);
            const totalRevenue = data.reduce((s, r) => s + parseNumber(r[COL.REVENUE]), 0);
            const totalPL = data.filter(r => !hasMissingCostData(r)).reduce((s, r) => s + getPLValue(r), 0);
            const shippedData = data.filter(r => getStatus(r) === 'shipped');
            const shippedPL = shippedData.filter(r => !hasMissingCostData(r)).reduce((s, r) => s + getPLValue(r), 0);
            const forecastData = data.filter(r => getStatus(r) !== 'shipped');
            const forecastPL = forecastData.filter(r => !hasMissingCostData(r)).reduce((s, r) => s + getPLValue(r), 0);
            
            document.getElementById('salesStatRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('salesStatOrderCount').textContent = `${data.length} orders`;
            document.getElementById('salesStatPL').textContent = formatCurrency(totalPL);
            document.getElementById('salesStatPL').className = `value ${totalPL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('salesStatMargin').textContent = `Margin: ${totalRevenue > 0 ? ((totalPL/totalRevenue)*100).toFixed(1) : 0}%`;
            document.getElementById('salesStatShippedPL').textContent = formatCurrency(shippedPL);
            document.getElementById('salesStatShippedPL').className = `value ${shippedPL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('salesStatShippedCount').textContent = `${shippedData.length} shipped`;
            document.getElementById('salesStatForecastPL').textContent = formatCurrency(forecastPL);
            document.getElementById('salesStatForecastPL').className = `value ${forecastPL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('salesStatForecastCount').textContent = `${forecastData.length} pending`;
            
            // Critical alerts
            const partStats = {};
            data.forEach(r => { const p = getVal(r, 'PART'); if (!partStats[p]) partStats[p] = { pl: 0 }; if (!hasMissingCostData(r)) partStats[p].pl += getPLValue(r); });
            const lossParts = Object.entries(partStats).filter(([_,v]) => v.pl < 0).sort((a,b) => a[1].pl - b[1].pl).slice(0,2);
            if (lossParts.length > 0) {
                document.getElementById('salesCriticalText').textContent = lossParts.map(([part, stats]) => `${part}: ${formatCurrency(stats.pl)}`).join(' | ');
                document.getElementById('salesCriticalBanner').classList.add('active');
            } else {
                document.getElementById('salesCriticalBanner').classList.remove('active');
            }
        }

        function renderSalesPartsData() {
            const data = allData.filter(r => partsFilters.categories[getCategory(r)]);
            const partStats = {};
            data.forEach(r => {
                const p = getVal(r, 'PART');
                if (!partStats[p]) partStats[p] = { orders: 0, qty: 0, revenue: 0, pl: 0 };
                partStats[p].orders++;
                partStats[p].qty += parseNumber(getVal(r, 'QTY'));
                partStats[p].revenue += parseNumber(r[COL.REVENUE]);
                if (!hasMissingCostData(r)) partStats[p].pl += getPLValue(r);
            });
            
            let partsArray = Object.entries(partStats).map(([part, stats]) => ({ part, ...stats, margin: stats.revenue > 0 ? (stats.pl / stats.revenue * 100) : 0 }));
            if (partsFilters.watchlistOnly) partsArray = partsArray.filter(p => isInWatchlist('part', p.part));
            partsArray.sort((a, b) => partsSort.asc ? a[partsSort.field] - b[partsSort.field] : b[partsSort.field] - a[partsSort.field]);
            
            document.getElementById('partsTableCount').textContent = `${partsArray.length} parts`;
            document.getElementById('partsTableHeader').innerHTML = '<th>‚òÖ</th><th>Part #</th><th>Orders</th><th>Qty</th><th>Revenue</th><th>P/L</th><th>Margin</th>';
            document.getElementById('partsTableBody').innerHTML = partsArray.slice(0, 100).map(p => `
                <tr class="clickable" onclick="showPartsCustomerDrilldown('${p.part.replace(/'/g, "\\'")}')">
                    <td><span class="watchlist-star ${isInWatchlist('part', p.part) ? 'active' : ''}" onclick="event.stopPropagation(); toggleWatchlistPart('${p.part.replace(/'/g, "\\'")}')">‚òÖ</span></td>
                    <td><strong>${p.part}</strong></td>
                    <td>${formatNumber(p.orders)}</td>
                    <td>${formatNumber(p.qty)}</td>
                    <td>${formatCurrency(p.revenue)}</td>
                    <td class="${p.pl >= 0 ? 'positive' : 'negative'}">${formatCurrency(p.pl)}</td>
                    <td class="${p.margin >= 0 ? 'positive' : 'negative'}">${p.margin.toFixed(1)}%</td>
                </tr>
            `).join('');
        }

        function renderSalesCustomersData() {
            const data = allData.filter(r => customersFilters.categories[getCategory(r)]);
            const custStats = {};
            data.forEach(r => {
                const c = getVal(r, 'CUSTOMER') || 'Unknown';
                if (!custStats[c]) custStats[c] = { orders: 0, qty: 0, revenue: 0, pl: 0 };
                custStats[c].orders++;
                custStats[c].qty += parseNumber(getVal(r, 'QTY'));
                custStats[c].revenue += parseNumber(r[COL.REVENUE]);
                if (!hasMissingCostData(r)) custStats[c].pl += getPLValue(r);
            });
            
            let custArray = Object.entries(custStats).map(([customer, stats]) => ({ customer, ...stats, margin: stats.revenue > 0 ? (stats.pl / stats.revenue * 100) : 0 }));
            if (customersFilters.watchlistOnly) custArray = custArray.filter(c => isInWatchlist('customer', c.customer));
            custArray.sort((a, b) => customersSort.asc ? a[customersSort.field] - b[customersSort.field] : b[customersSort.field] - a[customersSort.field]);
            
            document.getElementById('customersTableCount').textContent = `${custArray.length} customers`;
            document.getElementById('customersTableHeader').innerHTML = '<th>‚òÖ</th><th>Customer</th><th>Orders</th><th>Qty</th><th>Revenue</th><th>P/L</th><th>Margin</th>';
            document.getElementById('customersTableBody').innerHTML = custArray.slice(0, 100).map(c => `
                <tr class="clickable" onclick="showCustomersProductDrilldown('${c.customer.replace(/'/g, "\\'")}')">
                    <td><span class="watchlist-star ${isInWatchlist('customer', c.customer) ? 'active' : ''}" onclick="event.stopPropagation(); toggleWatchlistCustomer('${c.customer.replace(/'/g, "\\'")}')">‚òÖ</span></td>
                    <td><strong>${c.customer}</strong></td>
                    <td>${formatNumber(c.orders)}</td>
                    <td>${formatNumber(c.qty)}</td>
                    <td>${formatCurrency(c.revenue)}</td>
                    <td class="${c.pl >= 0 ? 'positive' : 'negative'}">${formatCurrency(c.pl)}</td>
                    <td class="${c.margin >= 0 ? 'positive' : 'negative'}">${c.margin.toFixed(1)}%</td>
                </tr>
            `).join('');
        }

        function renderSalesDatesData() {
            const data = allData.filter(r => datesFilters.categories[getCategory(r)]);
            const monthStats = {};
            data.forEach(r => {
                const dateStr = getAttributionDate(r);
                if (!dateStr) return;
                const month = getMonthKey(dateStr);
                if (!monthStats[month]) monthStats[month] = { orders: 0, shipped: 0, qty: 0, revenue: 0, pl: 0 };
                monthStats[month].orders++;
                monthStats[month].qty += parseNumber(getVal(r, 'QTY'));
                monthStats[month].revenue += parseNumber(r[COL.REVENUE]);
                if (getStatus(r) === 'shipped') monthStats[month].shipped++;
                if (!hasMissingCostData(r)) monthStats[month].pl += getPLValue(r);
            });
            
            const sortedMonths = Object.entries(monthStats).sort((a,b) => b[0].localeCompare(a[0]));
            const totalOrders = sortedMonths.reduce((s, [_,v]) => s + v.orders, 0);
            const totalUnits = sortedMonths.reduce((s, [_,v]) => s + v.qty, 0);
            const totalRevenue = sortedMonths.reduce((s, [_,v]) => s + v.revenue, 0);
            const totalPL = sortedMonths.reduce((s, [_,v]) => s + v.pl, 0);
            
            document.getElementById('datesStatOrders').textContent = formatNumber(totalOrders);
            document.getElementById('datesStatUnits').textContent = `${formatNumber(totalUnits)} units`;
            document.getElementById('datesStatRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('datesStatPL').textContent = formatCurrency(totalPL);
            document.getElementById('datesStatPL').className = `value ${totalPL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('datesStatMarginPct').textContent = `${totalRevenue > 0 ? ((totalPL/totalRevenue)*100).toFixed(1) : 0}%`;
            document.getElementById('datesStatMonths').textContent = `${sortedMonths.length} months`;
            document.getElementById('datesTableCount').textContent = `${sortedMonths.length} months`;
            
            document.getElementById('datesTableBody').innerHTML = sortedMonths.map(([month, stats]) => {
                const margin = stats.revenue > 0 ? ((stats.pl / stats.revenue) * 100).toFixed(1) : 0;
                return `<tr class="clickable" onclick="showDatesCustomerDrilldown('${month}')">
                    <td><strong>${formatMonthLabel(month)}</strong></td>
                    <td>${stats.shipped}/${stats.orders} Shipped</td>
                    <td>${formatNumber(stats.orders)}</td>
                    <td>${formatNumber(stats.qty)}</td>
                    <td>${formatCurrency(stats.revenue)}</td>
                    <td class="${stats.pl >= 0 ? 'positive' : 'negative'}">${formatCurrency(stats.pl)}</td>
                    <td class="${parseFloat(margin) >= 0 ? 'positive' : 'negative'}">${margin}%</td>
                </tr>`;
            }).join('');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadDashboard);
    </script>
</body>
</html>
